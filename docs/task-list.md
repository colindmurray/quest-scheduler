---
created: 2026-01-06
lastUpdated: 2026-02-17
summary: "Primary global execution tracker for current long-running work, checkpoints, and validation notes."
category: TASK_TRACKER
status: CURRENT
implementationStatus: ONGOING
note: "Canonical global tracker for active work and progress logging."
changelog:
  - "2026-02-17: Deployed latest calendar-voting and Discord repost refresh updates to staging and production (`hosting,functions`) after unit/integration/e2e validation pass."
  - "2026-02-17: Added Discord repost submitted-vote-count regression coverage (`votes: {}` treated as pending) and re-ran unit + integration + e2e validation gates across calendar voting and repost features."
  - "2026-02-17: Added Discord poll repost recovery coverage and creator-only poll-options visibility checks (new seeded e2e scenario + callable fallback test) to support manual panel refresh workflows."
  - "2026-02-17: Added month-calendar inline voting controls (compact durations, feasible/preferred buttons, multi-slot cycle control), calendar-view no-times toggle parity, and +more day modal flow with new unit/e2e coverage."
  - "2026-02-17: Deployed scheduler empty-vote vote-count fix to staging and production (hosting/functions/firestore/storage) after confirming Discord poll-card vote counts now use submitted-vote semantics."
  - "2026-02-17: Completed targeted validation pass for scheduler empty-vote semantics with unit coverage, full integration suite, and seeded Chromium e2e spec."
  - "2026-02-17: Fixed scheduler vote-submission semantics so empty vote docs (`votes: {}` + `noTimesWork: false`) are treated as pending across scheduler UI, dashboard summaries, and Discord/server vote counting; added slot-removal pruning to delete now-empty votes."
  - "2026-02-13: Aligned Discord ephemeral ranked recap ordering with web: tie-break rounds first, then ranked rounds newest-to-oldest, then user vote grid."
  - "2026-02-13: Updated ranked recap UX to show tie-break first, reverse ranked-round order, add Borda-all-options explanation matrix, and add deterministic random tie-break reveal animation."
  - "2026-02-13: Removed duplicate Discord general-poll finalization posts, routed to single notification message with dual links (web + poll card inspector), and simplified ranked final recap card to emphasize intermediate rounds."
  - "2026-02-13: Fixed Discord `bp_results` ingress ack to defer ephemerally so View Results opens the private inspector card flow; added regression coverage."
  - "2026-02-13: Expanded ranked tie-break coverage with integration and e2e tests; hardened ranked poll e2e login/navigation reliability."
  - "2026-02-12: Added ranked-choice tie-break workflow (Borda/random), creator-only `Break Tie` controls in web poll UIs, and Discord finalized-results inspector support for tie-break recap pages."
  - "2026-02-12: Deployed Discord/basic-poll production functions for finalized-results rendering and interaction handling (`processDiscordInteraction`, `processDiscordBasicPollUpdate`, `finalizeBasicPoll`, `processNotificationEvent`)."
  - "2026-02-12: Deployed the General Poll modal finalize UX update to production hosting after full validation gate pass."
  - "2026-02-12: Re-ran full unit/integration/e2e validation gate and deployed the General Poll modal finalize UX update to staging hosting."
  - "2026-02-12: Added Discord finalized-results inspector UI (final summary + ranked round navigation + per-user vote matrix with 50-cell cap fallback to web) and expanded interaction/card tests."
  - "2026-02-12: Adopted `chartscii` for Discord multiple-choice finalized-result histograms and added emulator integration coverage validating posted winner/result content."
  - "2026-02-12: Promoted General Poll modal finalize action to a prominent header button and added immediate finalized-state refresh in-modal."
  - "2026-02-12: Fixed Discord nudge duplicate mentions and upgraded basic-poll finalization Discord messages with winner/vote summaries, markdown links, and ASCII histogram output."
  - "2026-02-12: Deployed latest week/day calendar row-layout + compact time-range updates to staging and production hosting."
  - "2026-02-12: Dashboard week/day calendar events now use three-row layout (attendance row, full-width title row, compact time row) with compact same-meridiem range formatting and multi-day full date ranges."
  - "2026-02-12: Calendar event rendering now varies by view: month hides titles (attendance + time only), while week/day show attendance-prefixed titles with multiline wrapping."
  - "2026-02-12: Deployed dashboard calendar attendance/time label polish to staging and production hosting."
  - "2026-02-12: Dashboard month calendar attendance prefix now uses the shared Users icon style (`3/5`) instead of emoji text to match session poll chips."
  - "2026-02-12: Dashboard month calendar polish: added finalized-session attendance prefix (`ðŸ‘¥confirmed/total`) to month event titles, compacted month time labels (`6 PM` instead of `6:00 PM`), and removed forced event-content ellipsis styling."
  - "2026-02-12: Code Health Pt2 closed out: extracted Discord command dispatch router + CreateScheduler embedded-poll hook, ran full validation gate (web/functions/rules/integration/e2e/build), and marked phases complete/deferred in trackers."
  - "2026-02-12: Code Health Pt2 progress: extracted `useSchedulerEmbeddedPollVotes` from `SchedulerPage` (embedded-poll subscriptions + draft hydration), added direct hook tests, and revalidated full web test/build."
  - "2026-02-12: Code Health Pt2 progress: extracted shared basic-poll vote-draft mutation helpers, adopted them in scheduler embedded poll voting + dashboard group poll modal, and kicked off Phase 4.2 scheduler decomposition."
  - "2026-02-12: Code Health Pt2 progress: extracted dashboard basic-poll action orchestration into `use-dashboard-basic-poll-actions`, further reduced dashboard complexity, and re-ran full web + e2e emulator validation."
  - "2026-02-12: Code Health Pt2 progress: extracted dashboard basic-poll source/derivation into dedicated hook+lib modules, split pending-invite/general-poll sidebar sections, reduced `DashboardPage.jsx` to 1352 lines, and added direct tests for `DashboardCalendar` + `useCalendarNavigation`."
  - "2026-02-12: Code Health Pt2 progress: replaced dashboard/general-poll `window.confirm` delete flows with shared confirm dialogs, fixed stale Firestore hook error reset behavior, extracted dashboard filter/status utilities into `lib/dashboard-filters`, and expanded unit coverage."
  - "2026-02-12: Added Discord nudge coverage across functions and web layers (grouped required-poll sections, callable wrappers, shared nudge button helper/UI tests)."
  - "2026-02-12: Removed legacy `/poll-create` fallback payload support; Discord worker now requires explicit subcommands (`multiple`/`ranked`) and returns a clear error for legacy shape."
  - "2026-02-12: Updated Discord basic/general poll card formatting to include a clickable `View on web` embed field link (instead of non-clickable footer URL text), with tests and prod/staging function deploys."
  - "2026-02-12: Migrated Discord `/poll-create` to subcommands (`multiple`, `ranked`), updated worker parsing for subcommand payloads, re-registered commands (global + two guilds), and deployed Discord worker to prod/staging."
  - "2026-02-12: Fixed Discord ranked basic-poll voting failure by removing invalid collection-group documentId lookup in `processDiscordInteraction`, added regression coverage, and deployed worker to production/staging."
  - "2026-02-12: Removed redundant Firestore indexes rejected by deploy API (`basicPolls.order`, `votes.updatedAt`) and completed staging + production deploys from merged `master`."
  - "2026-02-12: Stabilized flaky dashboard embedded-poll e2e card click/login timing and re-ran full validation gate (web/functions/rules/integration/e2e emulators) with all suites passing."
  - "2026-02-12: Finalized General Poll modal polish pass (settings button, inline `+ Option | + Other`, ranked help icon simplification), reworked calendar nav alignment/centering, and redeployed hosting to staging."
  - "2026-02-12: Updated poll modal voting setup to multiple/ranked + customization popover chips (allow multiple, max selections), enforced max-selection bounds, and centered calendar nav controls within date picker."
  - "2026-02-12: Refined General Poll modal to compact single-column layout, moved voting setup into Options header, replaced deadline input with chip+popover calendar/time picker, and added write-in option toggle row."
  - "2026-02-12: Refined General Poll create/edit modal UX with wider two-panel layout, cleaner settings cards, improved option editing controls, and enhanced visual hierarchy."
  - "2026-02-12: Switched general-poll edit to shared create/edit modal flow, removed dedicated group-poll page routing in favor of dashboard redirect + modal open params, and added edit-mode modal test coverage."
  - "2026-02-12: Expanded Discord channel-role critical-event coverage to include general poll lifecycle events (created/finalized/re-opened/deleted), added scheduler cancel/restore lifecycle emits and delete role pings, and renamed Group settings copy to `Channel notification role`."
  - "2026-02-11: Removed Questing Groups page poll UI/logic (Polls/Open polls/Recent finalized/Create poll) and validated with focused settings tests + web build."
  - "2026-02-11: Moved date-filter `Clear` action into the date popover header row to remove unnecessary vertical space."
  - "2026-02-11: Centered chip labels, widened date filter popover, and hardened date-range normalization (always valid start/end ordering)."
  - "2026-02-11: Fixed newly-added dashboard filter chips auto-closing immediately by ignoring the first post-add dismiss event."
  - "2026-02-11: Switched chip filter editing to popover overlays (matching `+ Filter`) and removed apply buttons in favor of immediate-save behavior."
  - "2026-02-11: Reworked dashboard filters into chip-based add/edit/remove UX with `+ Filter`, animated editor panels, and compact one-line desktop layout."
  - "2026-02-11: Replaced dashboard filter block with a compact multi-filter bar (group colorized select, search, status multi-select, date window) and synced session calendar focus to the selected start date."
  - "2026-02-11: Deployed latest web/functions changes to staging (hosting, functions, storage rules, firestore rules)."
  - "2026-02-11: Fixed timezone label formatting so Pacific/Auckland no longer collapses to plain GMT during auto-convert."
  - "2026-02-11: Renamed dashboard/basic-poll UI copy to General Polls, added kebab action menus, converted scheduler embedded poll heading to Add-on polls, and switched scheduler add-on poll cards to 2-column layout."
  - "2026-02-11: Added desktop dashboard modal flow for group basic polls and introduced shared basic-poll voting card UI reused by scheduler embedded polls."
  - "2026-02-11: Switched dashboard basic-poll cards to whole-card navigation and removed inline edit-vote action button."
  - "2026-02-11: Aligned dashboard basic-poll cards with session-card UX language (hover, spacing, chips, avatar rows, accent borders)."
  - "2026-02-11: Fixed dashboard basic-poll loading loop by decoupling fetch state from derived card classification."
  - "2026-02-11: Added dashboard basic-poll UX card system with tabbed states, avatar stacks, tests, and staging deploy."
  - "2026-02-11: Added embedded poll independent finalize/reopen flow for scheduler polls and validated unit/rules/integration/e2e coverage."
  - "2026-02-11: Rechecked pending/ongoing doc statuses and corrected completed design docs."
  - "2026-02-02: chore: ignore local env and gemini settings"
  - "2026-02-02: chore: sync notifications, discord, and identity updates"
  - "2026-01-31: Add scheduler pending invite indexes"
  - "2026-01-31: Log production deploy"
  - "2026-01-31: Improve invite flows, notifications, and tests"
---

# Quest Scheduler â€” Task List

## Plan Execution Checkpoint
- Last Completed: Deployed latest calendar inline voting + Discord repost refresh updates to staging and production after full targeted unit/integration/e2e validation.
- Next Step: Manually sanity-check the poll-options repost action and month-calendar inline voting in production against a live Discord-linked poll.
- Open Issues: Integration suite still emits expected noisy notification trigger errors under emulators (`notificationEvents` NOT_FOUND); test command exits are passing.
- Last Updated (YYYY-MM-DD): 2026-02-17

## Progress Notes

- 2026-02-17: Discord poll repost refresh workflow validation + coverage.
  - Existing implementation confirmation:
    - Creator-facing poll-options action already exists in `web/src/features/scheduler/SchedulerPage.jsx` and calls `repostDiscordPollCard`.
    - Backend callable `functions/src/discord/repost.js` already deletes previous card (best-effort) and posts a new Discord poll card, then stores the new `discord.messageId`/`messageUrl`.
  - Web behavior update:
    - `web/src/features/scheduler/SchedulerPage.jsx`
      - Tightened repost-menu eligibility to require both linked Discord `channelId` and `guildId`, matching callable preconditions.
  - Coverage additions:
    - `functions/src/discord/repost.test.js`
      - Added regression test proving repost still succeeds when deleting the previous Discord message fails (stale/deleted-card recovery path).
    - `functions/scripts/seed-e2e-scheduler.js`
      - Added seeded Discord-linked scheduler/group fixture:
        - `E2E_DISCORD_REPOST_SCHEDULER_ID` (default `e2e-discord-repost-poll`)
        - `E2E_DISCORD_REPOST_GROUP_ID` (default `e2e-discord-repost-group`)
    - `web/e2e/scheduler-discord-repost-controls.spec.js` (new)
      - Validates creator sees `Repost Discord poll` in poll options.
      - Validates non-creator participant does not see the repost action.
  - Validation:
    - `npm --prefix functions run test -- src/discord/repost.test.js` (pass, `4 passed`, exit code `0`)
    - `bash -lc 'set -euo pipefail; ROOT_DIR="$(pwd)"; ENV_FILE="$ROOT_DIR/web/.env.e2e.local"; if [[ -f "$ENV_FILE" ]]; then set -a; source "$ENV_FILE"; set +a; fi; NODE_OPTIONS="${NODE_OPTIONS:-}"; if [[ "$NODE_OPTIONS" != *"--no-deprecation"* ]]; then export NODE_OPTIONS="${NODE_OPTIONS} --no-deprecation"; fi; export NODE_NO_WARNINGS=1; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node $ROOT_DIR/functions/scripts/seed-e2e-scheduler.js && npm --prefix $ROOT_DIR/web run test:e2e -- e2e/scheduler-discord-repost-controls.spec.js --project=chromium"'` (pass, `2 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `13 passed`, exit code `0`; expected emulator/function log noise persisted)

- 2026-02-17: Added final repost vote-count regression coverage and reran all relevant gates.
  - Coverage addition:
    - `functions/src/discord/repost.test.js`
      - Added test ensuring reposted Discord card uses submitted-vote semantics (`votes: {}` + `noTimesWork: false` remains pending and does not inflate the `Votes` field).
  - Validation:
    - `npm --prefix functions run test -- src/discord/repost.test.js` (pass, `5 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/scheduler/utils/calendar-month-vote-controls.test.js` (pass, `7 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `13 passed`, exit code `0`; expected emulator/function log noise persisted)
    - `bash -lc 'set -euo pipefail; ROOT_DIR="$(pwd)"; ENV_FILE="$ROOT_DIR/web/.env.e2e.local"; if [[ -f "$ENV_FILE" ]]; then set -a; source "$ENV_FILE"; set +a; fi; NODE_OPTIONS="${NODE_OPTIONS:-}"; if [[ "$NODE_OPTIONS" != *"--no-deprecation"* ]]; then export NODE_OPTIONS="${NODE_OPTIONS} --no-deprecation"; fi; export NODE_NO_WARNINGS=1; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node $ROOT_DIR/functions/scripts/seed-e2e-scheduler.js && npm --prefix $ROOT_DIR/web run test:e2e -- e2e/scheduler-month-calendar-vote-controls.spec.js e2e/scheduler-discord-repost-controls.spec.js --project=chromium"'` (pass, `3 passed`, exit code `0`)
    - `npm --prefix functions run test -- --coverage src/discord/repost.test.js` (pass; `repost.js` lines covered `90.62%`)
    - `npm --prefix web run test:coverage -- src/features/scheduler/utils/calendar-month-vote-controls.test.js` (pass; `calendar-month-vote-controls.js` lines covered `100%`)

- 2026-02-17: Staging + production deploy after coverage confirmation.
  - Deploy:
    - `DEPLOY_ONLY=hosting,functions ./scripts/deploy-staging.sh` (pass; `https://quest-scheduler-stg.web.app`)
    - `DEPLOY_ONLY=hosting,functions ./scripts/deploy-prod.sh` (pass; `https://studio-473406021-87ead.web.app`)

- 2026-02-17: Scheduler month-calendar inline voting UX improvements.
  - Web behavior updates:
    - `web/src/features/scheduler/SchedulerPage.jsx`
      - Month view event cards now show compact duration labels (`0m`, `45m`, `2h`, `1h30m`).
      - Added inline month voting controls:
        - single-slot day: separate feasible + preferred icon toggles.
        - multi-slot day: compact cycle button (`none -> feasible -> preferred -> none`).
      - Added `No times work for me` toggle in calendar view (parity with list view), with month inline controls hidden while enabled.
      - Event coloring now reflects draft vote state in month view (`FEASIBLE` green, `PREFERRED` gold glow) and greys calendar events when `noTimesWork` is enabled.
      - Month `+N more` now opens the day voting modal directly (`doShowMoreDrillDown={false}` + `onShowMore`), preserving quick voting for overflow days.
  - Added scheduler month-calendar utility + tests:
    - `web/src/features/scheduler/utils/calendar-month-vote-controls.js`
    - `web/src/features/scheduler/utils/calendar-month-vote-controls.test.js`
  - Added seeded e2e scenario and spec:
    - `functions/scripts/seed-e2e-scheduler.js` seeds `E2E_MONTH_VOTE_SCHEDULER_ID` (`e2e-month-calendar-votes`) with multi-slot same-day + single-slot day coverage.
    - `web/e2e/scheduler-month-calendar-vote-controls.spec.js` validates inline controls, cycle behavior, `+more` modal, and calendar no-times toggle behavior.
  - Validation:
    - `npm --prefix web run test -- src/features/scheduler/utils/calendar-month-vote-controls.test.js` (pass, `7 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `13 passed`, exit code `0`; expected emulator log noise persisted)
    - `bash -lc 'set -euo pipefail; ROOT_DIR="$(pwd)"; ENV_FILE="$ROOT_DIR/web/.env.e2e.local"; if [[ -f "$ENV_FILE" ]]; then set -a; source "$ENV_FILE"; set +a; fi; NODE_OPTIONS="${NODE_OPTIONS:-}"; if [[ "$NODE_OPTIONS" != *"--no-deprecation"* ]]; then export NODE_OPTIONS="${NODE_OPTIONS} --no-deprecation"; fi; export NODE_NO_WARNINGS=1; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node $ROOT_DIR/functions/scripts/seed-e2e-scheduler.js && npm --prefix $ROOT_DIR/web run test:e2e -- e2e/scheduler-month-calendar-vote-controls.spec.js --project=chromium"'` (pass, `1 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`; non-blocking chunk-size warning)

- 2026-02-17: Scheduler empty-vote pending-state fix (web + functions).
  - Root-cause alignment:
    - Added shared scheduler vote-submission predicate in both runtimes:
      - `web/src/lib/vote-utils.js`
      - `functions/src/utils/vote-utils.js`
    - New rule: submitted only when `noTimesWork === true` or at least one attending slot vote exists; `votes: {}` with `noTimesWork: false` is pending.
  - Web behavior updates:
    - `web/src/features/scheduler/SchedulerPage.jsx` now computes participant vote state, vote counts, nudge-missing lists, `allVotesIn`, and save/finalize transitions from submitted votes only.
    - Save flow now deletes the current user vote doc when no submission remains (instead of persisting empty vote docs).
    - `web/src/features/scheduler/CreateSchedulerPage.jsx` now deletes vote docs that become empty after slot removal during poll edits.
    - `web/src/features/dashboard/hooks/useSchedulerAttendance.js` now filters to submitted scheduler votes, fixing dashboard `All voted` and `Needs vote` states.
  - Functions/Discord behavior updates:
    - `functions/src/triggers/scheduler.js`, `functions/src/discord/repost.js`, and `functions/src/discord/nudge.js` now count only submitted scheduler votes.
  - Added/updated tests:
    - `web/src/lib/vote-utils.test.js`
    - `functions/src/utils/vote-utils.test.js`
    - Updated scheduler nudge fixtures in `functions/src/discord/nudge.test.js` to use valid attending vote values.
  - Validation:
    - `npm --prefix web run test -- src/lib/vote-utils.test.js src/features/dashboard/DashboardPage.test.jsx` (pass, `14 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/scheduler/utils/effective-votes.test.js` (pass, `6 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/utils/vote-utils.test.js src/discord/nudge.test.js src/discord/repost.test.js src/triggers/scheduler.test.js` (pass, `31 passed`, exit code `0`)
    - `npm --prefix web run test:coverage -- src/lib/vote-utils.test.js src/features/dashboard/hooks/useSchedulerAttendance.test.js src/features/dashboard/DashboardPage.test.jsx src/features/scheduler/utils/effective-votes.test.js` (pass, `21 passed`, exit code `0`)
    - `npm --prefix functions run test -- --coverage src/utils/vote-utils.test.js src/discord/nudge.test.js src/discord/repost.test.js src/triggers/scheduler.test.js` (pass, `31 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `13 passed`, exit code `0`; expected emulator/function log noise persisted)
    - `cd web && firebase emulators:exec 'npx vitest run --config vitest.integration.config.js src/__tests__/integration/scheduler-vote-submission.integration.test.js'` (pass, `1 passed`, exit code `0`)
    - `bash -lc 'set -euo pipefail; ROOT_DIR="$(pwd)"; ENV_FILE="$ROOT_DIR/web/.env.e2e.local"; if [[ -f "$ENV_FILE" ]]; then set -a; source "$ENV_FILE"; set +a; fi; NODE_OPTIONS="${NODE_OPTIONS:-}"; if [[ "$NODE_OPTIONS" != *"--no-deprecation"* ]]; then export NODE_OPTIONS="${NODE_OPTIONS} --no-deprecation"; fi; export NODE_NO_WARNINGS=1; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node $ROOT_DIR/functions/scripts/seed-e2e-scheduler.js && npm --prefix $ROOT_DIR/web run test:e2e -- e2e/scheduler-empty-vote-state.spec.js --project=chromium"'` (pass, `1 passed`, exit code `0`)
  - Deploy:
    - `DEPLOY_ONLY=hosting,functions,firestore,storage ./scripts/deploy-staging.sh` (pass; `https://quest-scheduler-stg.web.app`)
    - `DEPLOY_ONLY=hosting,functions,firestore,storage ./scripts/deploy-prod.sh` (pass; `https://studio-473406021-87ead.web.app`)

- 2026-02-13: Discord ephemeral ranked recap order alignment.
  - `functions/src/discord/worker.js` now orders ranked recap pages as:
    - tie-break rounds (newest to oldest),
    - ranked rounds (final to first),
    - player vote grid.
  - Updated tie-break page resolver to include the final tie-break round (not just prior rounds).
  - Validation:
    - `npm --prefix functions run test -- src/discord/worker.basic-poll.test.js src/discord/command-dispatch.test.js src/discord/ingress.test.js` (pass, `28 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/discord/worker.integration.test.js` (pass, `2 passed`, exit code `0`)

- 2026-02-13: Ranked tie-break recap UX refinement.
  - Web updates (`web/src/components/polls/basic-poll-voting-card.jsx`):
    - Recap page order now prioritizes tie-break context: final tie-break round first (if present), then ranked rounds in reverse order (latest to earliest), then player matrix.
    - Added explicit Borda copy clarifying points are computed across all options, not only tied finalists.
    - Added Borda point-contribution table by player and option.
    - Added deterministic random tie-break reveal animation that always ends on the persisted winner.
  - Validation:
    - `npm --prefix web run test -- src/components/polls/basic-poll-voting-card.test.jsx src/lib/basic-polls/ranked-choice-tie-break.test.js` (pass, `9 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/basic-polls/ranked-choice-tie-break.test.js` (pass, `4 passed`, exit code `0`)

- 2026-02-13: Refined Discord general-poll finalization messaging and recap UX after live validation feedback.
  - Duplicate finalize post fix:
    - Removed direct finalized-results channel post from `functions/src/discord/worker.js` finalize handler.
    - Kept notification event emission (`BASIC_POLL_FINALIZED` + `BASIC_POLL_RESULTS`) so Discord posting goes through one path only.
  - Dual-link finalized message:
    - Added `discordPollCardUrl` payload propagation in `functions/src/basic-polls/callables.js` and Discord finalize worker payload emission.
    - Updated `functions/src/notifications/discord.js` finalized message formatting to include:
      - web results link (`View full poll results`)
      - Discord poll card jump link (`Open Discord poll card (View Results)`) when available.
    - Added DB fallback lookup for poll card URL in notification routing when payload omits it.
  - Ranked recap/chart tuning:
    - Web ranked final recap card (`web/src/components/polls/basic-poll-voting-card.jsx`) now omits final-only histogram and points users to recap arrows for intermediate/tie-break rounds.
    - Discord ephemeral results inspector now includes both `Open in Quest Scheduler` and `Open Poll Card` URL buttons.
  - Validation:
    - `npm --prefix functions run test -- src/discord/worker.basic-poll.test.js src/discord/worker.integration.test.js src/notifications/discord.test.js src/basic-polls/callables.test.js` (pass, `47 passed`, exit code `0`)
    - `npm --prefix web run test -- src/components/polls/basic-poll-voting-card.test.jsx` (pass, `4 passed`, exit code `0`)

- 2026-02-13: Fixed Discord `View Results` ephemeral linkage for basic polls.
  - Backend:
    - `functions/src/discord/ingress.js` now treats `bp_results:*` open interactions as ephemeral defers (`type: 5`, `flags: 64`) so the results inspector opens as an ephemeral card flow instead of editing the channel card.
  - Coverage:
    - `functions/src/discord/ingress.test.js` adds regression coverage for `bp_results:poll1` ephemeral defer behavior.
  - Validation:
    - `npm --prefix functions run test -- src/discord/ingress.test.js` (pass, `9 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/discord/command-dispatch.test.js` (pass, `5 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/discord/worker.basic-poll.test.js` (pass, `14 passed`, exit code `0`)

- 2026-02-13: Added explicit unit/integration/e2e coverage for ranked tie-break flow.
  - Tests added/updated:
    - Integration:
      - `web/src/__tests__/integration/basic-polls.integration.test.js`
        - added ranked tie-break persistence scenario (`BORDA` then `RANDOM`) validating stored `tieBreakerRounds` and winner resolution.
    - E2E:
      - `web/e2e/basic-poll-ranked.spec.js`
        - added creator flow: finalize tied ranked poll, run Borda tie-break, run random winner selection, and validate recap arrow navigation through round progression.
        - hardened login helper to match existing resilient e2e auth pattern.
  - Validation:
    - `npm --prefix web run test -- src/lib/basic-polls/ranked-choice-tie-break.test.js src/components/polls/basic-poll-voting-card.test.jsx src/lib/data/basicPolls.test.js` (pass, `35 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/basic-polls/ranked-choice-tie-break.test.js src/basic-polls/callables.test.js` (pass, `25 passed`, exit code `0`)
    - `firebase emulators:exec "npm --prefix web run test -- --config vitest.integration.config.js src/__tests__/integration/basic-polls.integration.test.js"` (pass, `9 passed`, exit code `0`; emulator log noise from notification side-effects persisted)
    - `set -a; source web/.env.e2e.local; set +a; export NODE_OPTIONS="${NODE_OPTIONS:-} --no-deprecation"; export NODE_NO_WARNINGS=1; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node functions/scripts/seed-e2e-scheduler.js && npm --prefix web run test:e2e -- web/e2e/basic-poll-ranked.spec.js"` (pass, `2 passed`, `6 skipped`, exit code `0`)

- 2026-02-12: Added ranked-choice tie-break actions + recap progression support.
  - Backend:
    - Added shared tie-break utility for ranked polls (`BORDA` and `RANDOM`) in:
      - `functions/src/basic-polls/ranked-choice-tie-break.js`
      - `web/src/lib/basic-polls/ranked-choice-tie-break.js`
    - Added callable `breakBasicPollTie` with manager/creator auth gates and `BASIC_POLL_RESULTS` emission in `functions/src/basic-polls/callables.js`.
    - Updated Discord finalized-results inspector (`functions/src/discord/worker.js`) to include tie-break recap pages in order: final round, prior tie-break rounds, ranked rounds, player matrix.
  - Web:
    - Added creator tie-break controls (`Break Tie` + method chooser, or `Select random winner` after Borda tie) and round recap navigation with arrow paging in `web/src/components/polls/basic-poll-voting-card.jsx`.
    - Wired tie-break actions into:
      - `web/src/features/dashboard/components/group-basic-poll-modal.jsx`
      - `web/src/features/scheduler/SchedulerPage.jsx`
    - Added `breakBasicPollTieForParent` to data layer (`web/src/lib/data/basicPolls.js`).
    - Added `recharts` histograms for ranked recap views in web poll results.
  - Validation:
    - `npm --prefix web run test -- src/lib/basic-polls/ranked-choice-tie-break.test.js src/components/polls/basic-poll-voting-card.test.jsx src/features/dashboard/components/group-basic-poll-modal.test.jsx src/lib/data/basicPolls.test.js` (pass, `37 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/basic-polls/ranked-choice-tie-break.test.js src/basic-polls/callables.test.js src/discord/worker.basic-poll.test.js src/discord/basic-poll-card.test.js` (pass, `43 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/discord/command-dispatch.test.js src/discord/worker.integration.test.js` (pass, `7 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`; non-blocking chunk-size warning)

- 2026-02-12: Production functions deploy for Discord finalized-results logic.
  - Deploy:
    - `firebase deploy --project default --only functions:processDiscordInteraction,functions:processDiscordBasicPollUpdate,functions:finalizeBasicPoll,functions:processNotificationEvent` (pass)

- 2026-02-12: Production deploy for General Poll finalize UX update.
  - Deploy:
    - `DEPLOY_ONLY=hosting ./scripts/deploy-prod.sh` (pass; `https://studio-473406021-87ead.web.app`)

- 2026-02-12: Validation gate + staging deploy for General Poll finalize UX update.
  - Validation:
    - `npm --prefix web run test` (pass, `391 passed`, exit code `0`)
    - `npm --prefix functions run test` (pass, `377 passed`, exit code `0`)
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, exit code `0`; expected emulator log noise persisted)
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)
  - Deploy:
    - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; `https://quest-scheduler-stg.web.app`)

- 2026-02-12: Implemented Discord finalized-results inspector flow for basic polls.
  - Backend updates:
    - `functions/src/discord/basic-poll-card.js` finalized cards now include `View Results` (interactive) plus `Open on Web`.
    - `functions/src/discord/command-dispatch.js` adds dedicated routes for `bp_results`, `bp_results_prev`, `bp_results_next`, and `bp_results_select`.
    - `functions/src/discord/worker.js` adds:
      - shared final results page for both poll types
      - multiple-choice histogram rendering (`chartscii`)
      - ranked-choice round-by-round pages with elimination notes
      - per-user vote matrix page for both poll types
      - hard cap fallback (`> 50` cells) to Quest Scheduler web results.
  - Coverage:
    - `functions/src/discord/basic-poll-card.test.js`
    - `functions/src/discord/command-dispatch.test.js`
    - `functions/src/discord/worker.basic-poll.test.js`
  - Validation:
    - `npm --prefix functions run test -- src/discord/nudge.test.js src/notifications/discord.test.js src/basic-polls/callables.test.js src/discord/basic-poll-card.test.js src/discord/command-dispatch.test.js src/discord/worker.basic-poll.test.js src/discord/worker.integration.test.js` (pass, `61 passed`, exit code `0`)

- 2026-02-12: Extended Discord finalized-results coverage with `chartscii` and emulator integration assertions.
  - Backend updates:
    - Added `chartscii` dependency in `functions/package.json` for richer text-based histogram rendering in Discord finalized basic-poll notifications.
    - `functions/src/notifications/discord.js` now uses `chartscii` output for multiple-choice `Results histogram` blocks (manual fallback retained for robustness).
    - `functions/src/discord/worker.integration.test.js` now validates that Discord finalize flow posts a results message containing winning option and vote details.
  - Coverage:
    - `functions/src/notifications/discord.test.js` now asserts chart output includes percentage-formatted rows (example `Pizza (80.00%)`).
    - `functions/src/discord/worker.integration.test.js` adds an emulator-backed finalization assertion for posted winner/result content and poll link.
  - Validation:
    - `npm --prefix functions run test -- src/discord/nudge.test.js src/notifications/discord.test.js src/basic-polls/callables.test.js src/discord/worker.basic-poll.test.js src/discord/worker.integration.test.js` (pass, `48 passed`, exit code `0`)

- 2026-02-12: Updated General Poll modal finalize UX for creators.
  - UI updates:
    - `web/src/features/dashboard/components/group-basic-poll-modal.jsx` now renders `Finalize` as a high-visibility header button (removed from kebab menu).
    - Finalize success path now applies an optimistic modal-state update to `FINALIZED` with locally computed final results so the finalized page appears immediately.
  - Coverage:
    - `web/src/features/dashboard/components/group-basic-poll-modal.test.jsx` adds a regression test asserting:
      - finalize action is a top-level button
      - finalize is not present in the dropdown menu
      - modal flips to finalized view right after finalize action
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/components/group-basic-poll-modal.test.jsx` (pass, `2 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`)

- 2026-02-12: Polished Discord nudge/finalization messaging for session + basic polls.
  - Backend updates:
    - `functions/src/discord/nudge.js` removed the redundant mention-only line from scheduler nudge content so the single `Hey! ...` mention block is the only user ping section.
    - `functions/src/basic-polls/callables.js` and `functions/src/discord/worker.js` now attach `payload.discordResults` on `BASIC_POLL_FINALIZED`/`BASIC_POLL_RESULTS` events for richer downstream Discord rendering.
    - `functions/src/notifications/discord.js` now formats basic-poll finalization notifications with:
      - explicit winner/tie summary including vote counts
      - total votes cast line
      - markdown link style (`[View full poll results](<url>)`)
      - ASCII histogram block (` ```text ... ``` `) for option distribution
  - Coverage:
    - `functions/src/discord/nudge.test.js` now asserts each mentioned user appears only once in the scheduler nudge payload.
    - Added finalized-summary assertions in:
      - `functions/src/notifications/discord.test.js`
      - `functions/src/basic-polls/callables.test.js`
      - `functions/src/discord/worker.basic-poll.test.js`
  - Validation:
    - `npm --prefix functions run test -- src/discord/nudge.test.js src/notifications/discord.test.js src/basic-polls/callables.test.js src/discord/worker.basic-poll.test.js` (pass, `46 passed`, exit code `0`)

- 2026-02-12: Released latest dashboard calendar week/day layout iteration.
  - Deploy:
    - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; `https://quest-scheduler-stg.web.app`)
    - `DEPLOY_ONLY=hosting ./scripts/deploy-prod.sh` (pass; `https://studio-473406021-87ead.web.app`)

- 2026-02-12: Improved week/day calendar event readability in constrained columns.
  - UI updates:
    - `web/src/features/dashboard/components/DashboardCalendar.jsx` now uses a three-row week/day event layout: attendance/status row, full-width title row, and time row.
    - Added compact same-meridiem time range formatting (example: `6 - 10:30 PM`) and preserved full date-time labels for multi-day events.
    - Month view remains compact (attendance + time, no title) as requested.
  - Coverage:
    - Extended `web/src/features/dashboard/components/DashboardCalendar.test.jsx` to validate compact same-meridiem ranges and multi-day full-date ranges.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/components/DashboardCalendar.test.jsx` (pass, `4 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Refined dashboard calendar event content layout by view.
  - UI updates:
    - `web/src/features/dashboard/components/DashboardCalendar.jsx` now renders month events as compact `attendance + time` only (no title text) to preserve legibility in constrained monthly cells.
    - Week/day events now include attendance icon+count as a prefix to the title and use multiline title wrapping rather than truncation.
    - `web/src/features/scheduler/calendar-styles.css` adds explicit wrapping styles for week/day calendar event titles and time labels.
  - Coverage:
    - Updated `web/src/features/dashboard/components/DashboardCalendar.test.jsx` assertions for shared `attendanceLabel` event field.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/components/DashboardCalendar.test.jsx` (pass, `3 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Released dashboard calendar attendance/time label polish.
  - Deploy:
    - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; `https://quest-scheduler-stg.web.app`)
    - `DEPLOY_ONLY=hosting ./scripts/deploy-prod.sh` (pass; `https://studio-473406021-87ead.web.app`)

- 2026-02-12: Refined dashboard month attendance indicator style for consistency.
  - UI updates:
    - `web/src/features/dashboard/components/DashboardCalendar.jsx` now renders month attendance with the shared `Users` icon style + compact `confirmed/total` label (`3/5`) rather than an emoji text prefix in the title.
    - Kept compact month time formatting and standard week/day rendering unchanged.
    - Added `.dashboard-calendar-attendance` style in `web/src/features/scheduler/calendar-styles.css`.
  - Coverage:
    - Updated `web/src/features/dashboard/components/DashboardCalendar.test.jsx` to assert `monthAttendanceLabel` data.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/components/DashboardCalendar.test.jsx` (pass, `3 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Polished dashboard month calendar event density/readability.
  - UI updates:
    - `web/src/features/dashboard/components/DashboardCalendar.jsx` now derives month-only attendance title prefixes for finalized sessions (`ðŸ‘¥confirmed/total`) and month-compact time labels (`h a`, dropping `:00` on the hour).
    - Added month/week/day-specific event render wiring so compact labels are used in month view without changing week/day time range rendering.
    - `web/src/features/scheduler/calendar-styles.css` no longer forces `text-overflow: ellipsis` on calendar event content; time labels are now non-shrinking (`.dashboard-calendar-event-time`) to avoid trailing PM ellipsis clipping.
  - Coverage:
    - Added assertions in `web/src/features/dashboard/components/DashboardCalendar.test.jsx` for month attendance prefix and compact month time label generation.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/components/DashboardCalendar.test.jsx` (pass, `3 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 closeout and finalized remaining decomposition slices.
  - Decomposition:
    - Added `functions/src/discord/command-dispatch.js` and refactored `functions/src/discord/worker.js` to delegate interaction routing.
    - Added `web/src/features/scheduler/hooks/useSchedulerEditorEmbeddedPolls.js` and refactored `web/src/features/scheduler/CreateSchedulerPage.jsx` to consume it.
  - Coverage:
    - Added `functions/src/discord/command-dispatch.test.js`.
    - Added `web/src/features/scheduler/hooks/useSchedulerEditorEmbeddedPolls.test.js`.
  - Validation:
    - `npm --prefix functions run test -- src/discord/command-dispatch.test.js src/discord/worker.handlers.test.js src/discord/worker.poll-create.test.js src/discord/worker.vote.test.js` (pass, `27 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/scheduler/hooks/useSchedulerEditorEmbeddedPolls.test.js src/features/scheduler/hooks/useSchedulerEmbeddedPollVotes.test.js src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx` (pass, `6 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `388 passed`, exit code `0`)
    - `npm --prefix functions run test` (pass, `370 passed`, exit code `0`)
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; known emulator log noise from notification reconciliation persisted)
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Continued Code Health Pt2 Phase 4.2 with scheduler embedded-poll subscription extraction.
  - Decomposition:
    - Added `web/src/features/scheduler/hooks/useSchedulerEmbeddedPollVotes.js` to own embedded poll subscriptions (poll docs, vote docs, my vote docs) and vote-draft hydration.
    - Refactored `web/src/features/scheduler/SchedulerPage.jsx` to consume the hook and removed inline embedded-poll subscription effects.
    - Reused shared `hasSubmittedVoteForPoll` in `CreateSchedulerPage` for embedded vote-counting logic.
  - Coverage:
    - Added `web/src/features/scheduler/hooks/useSchedulerEmbeddedPollVotes.test.js`.
  - Validation:
    - `npm --prefix web run test -- src/features/scheduler/hooks/useSchedulerEmbeddedPollVotes.test.js src/features/scheduler/hooks/useSchedulerData.test.js` (pass, `4 passed`, exit code `0`)
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/features/dashboard/components/group-basic-poll-modal.test.jsx` (pass, `11 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `386 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Kicked off Code Health Pt2 Phase 4.2 by extracting shared vote-draft mutations.
  - Decomposition:
    - Added `web/src/lib/basic-polls/vote-draft.js` to centralize vote-draft interactions (single/multi toggle, ranked add/move/remove, other-text updates).
    - Refactored `web/src/features/scheduler/SchedulerPage.jsx` embedded poll voting draft handlers to consume shared helpers.
    - Refactored `web/src/features/dashboard/components/group-basic-poll-modal.jsx` vote-draft handlers to consume shared helpers, including max-selection limit handling.
    - Replaced duplicated embedded vote-submission checks in `web/src/features/scheduler/SchedulerPage.jsx` and `web/src/features/scheduler/CreateSchedulerPage.jsx` with shared `hasSubmittedVoteForPoll`.
  - Coverage:
    - Added `web/src/lib/basic-polls/vote-draft.test.js`.
  - Validation:
    - `npm --prefix web run test -- src/lib/basic-polls/vote-draft.test.js src/features/dashboard/components/group-basic-poll-modal.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `15 passed`, exit code `0`)
    - `npm --prefix web run test -- src/lib/basic-polls/vote-submission.test.js src/components/polls/basic-poll-voting-card.test.jsx` (pass, `7 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `384 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Continued Code Health Pt2 with dashboard modal/edit orchestration extraction.
  - Decomposition:
    - Added `web/src/features/dashboard/hooks/use-dashboard-general-poll-modals.js`.
    - Refactored `web/src/features/dashboard/DashboardPage.jsx` to delegate group/general poll open/edit/create modal state and handlers.
  - Coverage:
    - Added `web/src/features/dashboard/hooks/use-dashboard-general-poll-modals.test.js`.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/hooks/use-dashboard-general-poll-modals.test.js src/features/dashboard/DashboardPage.test.jsx` (pass, `13 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `380 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Added Discord poll-description truncation budgets for cleaner embeds.
  - Added shared helper: `functions/src/discord/card-description.js`.
    - Enforces description budget at 25% of Discord description limit (`1024` chars of `4096`).
    - Applies row-aware wrapping cap (~`75` chars/row), explicit newline cap, and word-count cap.
    - Appends `_View full content on [Quest Scheduler](<poll-url>)._` when truncation occurs.
  - Integrated helper into:
    - `functions/src/discord/poll-card.js`
    - `functions/src/discord/basic-poll-card.js`
  - Coverage:
    - Added `functions/src/discord/card-description.test.js`.
    - Expanded:
      - `functions/src/discord/poll-card.test.js`
      - `functions/src/discord/basic-poll-card.test.js`
  - Validation:
    - `npm --prefix functions run test -- src/discord/card-description.test.js src/discord/poll-card.test.js src/discord/basic-poll-card.test.js` (pass, `12 passed`, exit code `0`)

- 2026-02-12: Continued Code Health Pt2 with dashboard basic-poll action orchestration extraction.
  - Decomposition:
    - Added `web/src/features/dashboard/hooks/use-dashboard-basic-poll-actions.js`.
    - Refactored `web/src/features/dashboard/DashboardPage.jsx` to delegate archive/finalize/reopen/delete action handling + busy state + delete confirmation state for basic polls.
    - Reduced `web/src/features/dashboard/DashboardPage.jsx` from `1352` lines to `1288` lines.
  - Coverage:
    - Added `web/src/features/dashboard/hooks/use-dashboard-basic-poll-actions.test.js`.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/hooks/use-dashboard-basic-poll-actions.test.js src/features/dashboard/DashboardPage.test.jsx` (pass, `13 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `377 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)
    - `npm --prefix functions run test` (pass, `366 passed`, exit code `0`)
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)

- 2026-02-12: Polished Discord poll card parity between scheduler and general polls.
  - Session (`functions/src/discord/poll-card.js`) updates:
    - Added calendar-prefixed scheduler titles (`ðŸ“…`).
    - Replaced raw URL embed description with optional scheduler description text (`scheduler.description`) when present.
    - Added clickable `View on web` field using `[Open poll](...)` to match general poll card UX.
  - General poll (`functions/src/discord/basic-poll-card.js`) update:
    - Trimmed description whitespace before embedding so optional description rendering is clean.
  - Coverage updates:
    - `functions/src/discord/poll-card.test.js`
    - `functions/src/discord/basic-poll-card.test.js`
  - Validation:
    - `npm --prefix functions run test -- src/discord/poll-card.test.js src/discord/basic-poll-card.test.js` (pass, `6 passed`, exit code `0`)

- 2026-02-12: Continued Code Health Pt2 with deeper Dashboard decomposition and hotspot test backfill.
  - Decomposition:
    - Added `web/src/features/dashboard/hooks/use-dashboard-basic-poll-source.js` to own group+embedded poll fetch orchestration for dashboard surfaces.
    - Added `web/src/features/dashboard/lib/dashboard-basic-polls.js` to centralize dashboard poll derivation, bucketing, and user-card mapping helpers.
    - Added `web/src/features/dashboard/components/pending-invites-section.jsx` and `web/src/features/dashboard/components/general-polls-section.jsx`, and refactored `web/src/features/dashboard/DashboardPage.jsx` to delegate those sidebar sections.
    - Reduced `web/src/features/dashboard/DashboardPage.jsx` from `1629` lines to `1352` lines.
  - Coverage:
    - Added tests:
      - `web/src/features/dashboard/lib/dashboard-basic-polls.test.js`
      - `web/src/features/dashboard/hooks/use-dashboard-basic-poll-source.test.js`
      - `web/src/features/dashboard/components/pending-invites-section.test.jsx`
      - `web/src/features/dashboard/components/general-polls-section.test.jsx`
      - `web/src/features/dashboard/components/DashboardCalendar.test.jsx`
      - `web/src/hooks/useCalendarNavigation.test.js`
  - Dependency review:
    - Recorded Code Health Pt2 dependency adopt/reject/defer decisions in `docs/decisions.md` for `react-hook-form`, `zod`, `@hookform/resolvers`, `@testing-library/jest-dom`, `msw`, `framer-motion`, and `chrono-node`/`ms` consideration.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/features/dashboard/lib/dashboard-basic-polls.test.js src/features/dashboard/hooks/use-dashboard-basic-poll-source.test.js src/features/dashboard/components/pending-invites-section.test.jsx src/features/dashboard/components/general-polls-section.test.jsx` (pass, `22 passed`, exit code `0`)
    - `npm --prefix web run test -- src/hooks/useCalendarNavigation.test.js src/features/dashboard/components/DashboardCalendar.test.jsx` (pass, `5 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `374 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)
    - `npm --prefix functions run test` (pass, `360 passed`, exit code `0`)
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; known emulator log noise from `processNotificationEvent` NOT_FOUND/socket-hangup persisted)
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)

- 2026-02-12: Continued Code Health Pt2 execution with another Dashboard decomposition slice and test backfill.
  - Decomposition:
    - Added `web/src/features/dashboard/components/dashboard-filter-bar.jsx`.
    - Refactored `web/src/features/dashboard/DashboardPage.jsx` to delegate filter UI rendering to the new component.
  - Coverage:
    - Added direct component tests for `web/src/components/polls/basic-poll-voting-card.jsx` via `web/src/components/polls/basic-poll-voting-card.test.jsx`.
  - Validation:
    - `npm --prefix web run test -- src/components/polls/basic-poll-voting-card.test.jsx src/features/dashboard/DashboardPage.test.jsx src/features/dashboard/lib/dashboard-filters.test.js src/features/dashboard/components/group-basic-poll-modal.test.jsx` (pass, `19 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `357 passed`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)
    - `npm --prefix functions run test` (pass, `360 passed`, exit code `0`)

- 2026-02-12: Continued Code Health Pt2 implementation (Phases 5.2, 6.1, and 4.1 kickoff slice).
  - Stale Firestore error reset hardening:
    - Updated `web/src/hooks/useFirestoreDoc.js` and `web/src/hooks/useFirestoreCollection.js` to clear stale `error` values on ref changes and null refs.
    - Added regression coverage in `web/src/hooks/useFirestoreDoc.test.js` and `web/src/hooks/useFirestoreCollection.test.js`.
  - Confirm dialog migration:
    - Added shared `web/src/components/ui/confirm-dialog.jsx` (+ `web/src/components/ui/confirm-dialog.test.jsx`).
    - Replaced native confirm deletes in `web/src/features/dashboard/DashboardPage.jsx` and `web/src/features/dashboard/components/group-basic-poll-modal.jsx`.
    - Added/expanded delete-flow tests in:
      - `web/src/features/dashboard/components/group-basic-poll-modal.test.jsx`
      - `web/src/features/dashboard/DashboardPage.test.jsx`
    - Verified no remaining native confirms in web app: `rg -n "window\\.confirm" web/src` (no matches).
  - Dashboard monolith decomposition kickoff:
    - Added `web/src/features/dashboard/lib/dashboard-filters.js` and `web/src/features/dashboard/lib/dashboard-filters.test.js`.
    - `DashboardPage` now imports filter/status/date helpers from the extracted module.
    - Removed dead `useNavigate` binding in `DashboardPage`.
  - Validation:
    - `npm --prefix web run test -- src/features/dashboard/lib/dashboard-filters.test.js src/features/dashboard/DashboardPage.test.jsx src/features/dashboard/components/group-basic-poll-modal.test.jsx src/hooks/useFirestoreDoc.test.js src/hooks/useFirestoreCollection.test.js src/components/ui/confirm-dialog.test.jsx` (pass, `23 passed`, exit code `0`)
    - `npm --prefix web run test` (pass, `354 passed`, exit code `0`)
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; first run failed to start Firestore emulator due occupied port, immediate rerun passed)
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)
    - `npm --prefix functions run test` (pass, `360 passed`, exit code `0`)

- 2026-02-12: Expanded Discord nudge test coverage following AGENTS testing conventions (functions Discord-send assertions + web data/UI layer tests).
  - Added function regression coverage in `functions/src/discord/nudge.test.js`:
    - Validates required embedded poll grouping behavior where multiple required polls with the same missing-user set are emitted as one grouped section in the Discord nudge message.
    - Continues to assert outbound Discord send payloads via mocked `createChannelMessage` (the established repo convention for Discord emission validation).
  - Added web-layer coverage:
    - `web/src/lib/data/discord.test.js`: callable wrapper tests for `nudgeDiscordSessionPoll` and `nudgeDiscordBasicPoll`.
    - `web/src/components/polls/poll-nudge-button.test.jsx`: UI/helper tests for cooldown math + button label/disabled behavior.
  - Validation:
    - `npm --prefix functions run test -- src/discord/nudge.test.js` (pass, `10 passed`, exit code `0`)
    - `npm --prefix web run test -- src/lib/data/discord.test.js src/components/polls/poll-nudge-button.test.jsx` (pass, `13 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; existing emulator `notificationEvents` NOT_FOUND/socket-hangup log noise observed, suite still succeeded)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 Phase 3.2 (poll domain constants in high-touch paths).
  - Added constants modules:
    - `web/src/lib/basic-polls/constants.js`
    - `functions/src/basic-polls/constants.js`
  - Updated high-touch consumers:
    - `web/src/lib/basic-polls/vote-submission.js`
    - `functions/src/basic-polls/vote-submission.js`
    - `web/src/lib/data/basicPolls.js`
    - `web/src/features/dashboard/components/group-basic-poll-modal.jsx`
    - `web/src/components/polls/basic-poll-voting-card.jsx`
    - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`
    - `functions/src/basic-polls/callables.js`
    - `functions/src/basic-polls/required-summary.js`
    - `functions/src/triggers/basic-poll-card.js`
  - Added constants coverage:
    - `web/src/lib/basic-polls/constants.test.js`
    - `functions/src/basic-polls/constants.test.js`
  - Validation:
    - `npm --prefix web run test -- src/lib/basic-polls/constants.test.js src/lib/basic-polls/vote-submission.test.js src/lib/data/basicPolls.test.js src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/dashboard/DashboardPage.test.jsx src/lib/time.test.js` (pass, `52 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/basic-polls/constants.test.js src/basic-polls/vote-submission.test.js src/basic-polls/required-summary.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js src/triggers/basic-poll-card.test.js` (pass, `44 passed`, exit code `0`)

- 2026-02-12: Full validation gate after Code Health Pt2 Phases 2.1â€“3.2:
  - `npm --prefix web run test` (pass, `337 passed`, exit code `0`)
  - `npm --prefix functions run test` (pass, `361 passed`, exit code `0`)
  - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`)
  - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; emulator log noise only)
  - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)
  - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 Phase 3.1 (notification event parity guard).
  - Added canonical web notification-event module:
    - `web/src/lib/notification-types.js`
  - Updated web notification data layer to consume shared constants:
    - `web/src/lib/data/notifications.js`
  - Added cross-runtime parity test:
    - `functions/src/notifications/constants.parity.test.js`
  - Validation:
    - `npm --prefix web run test -- src/lib/data/notifications.test.js src/lib/data/notification-events.test.js src/components/ui/notification-dropdown.test.jsx src/components/ui/notification-bell.test.jsx` (pass, `14 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/notifications/constants.test.js src/notifications/constants.parity.test.js src/notifications/router.test.js src/notifications/reconcile.test.js src/notifications/shared.test.js` (pass, `18 passed`, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 Phase 2.4 (notification metadata/hash helper consolidation).
  - Added shared Functions module:
    - `functions/src/notifications/shared.js`
  - Refactored consumers:
    - `functions/src/notifications/router.js`
    - `functions/src/notifications/reconcile.js`
  - Added coverage:
    - `functions/src/notifications/shared.test.js`
  - Validation:
    - `npm --prefix functions run test -- src/notifications/shared.test.js src/notifications/router.test.js src/notifications/reconcile.test.js` (pass, `13 passed`, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 Phase 2.3 (date coercion consolidation).
  - Added shared utility:
    - `web/src/lib/time.js` now exports `coerceDate`.
  - Removed duplicated local `toDate` implementations in:
    - `web/src/lib/data/basicPolls.js`
    - `web/src/features/dashboard/components/group-basic-poll-modal.jsx`
    - `web/src/components/polls/basic-poll-voting-card.jsx`
    - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`
    - `web/src/features/dashboard/DashboardPage.jsx`
  - Added coverage:
    - `web/src/lib/time.test.js` (`coerceDate` scenarios)
  - Validation:
    - `npm --prefix web run test -- src/lib/time.test.js src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `46 passed`, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 Phase 2.2 (safe navigation fallback consolidation).
  - Added shared hook:
    - `web/src/hooks/useSafeNavigate.js`
  - Added unit coverage:
    - `web/src/hooks/useSafeNavigate.test.jsx`
  - Replaced duplicated `navigate + setTimeout + window.location.assign` blocks in:
    - `web/src/components/polls/basic-poll-card.jsx`
    - `web/src/features/dashboard/components/SessionCard.jsx`
    - `web/src/features/dashboard/components/NextSessionCard.jsx`
    - `web/src/features/dashboard/components/MobileAgendaView.jsx`
    - `web/src/features/dashboard/components/DashboardCalendar.jsx`
    - `web/src/features/dashboard/DashboardPage.jsx`
  - Validation:
    - `npm --prefix web run test -- src/hooks/useSafeNavigate.test.jsx src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `39 passed`, exit code `0`)

- 2026-02-12: Completed Code Health Pt2 Phase 2.1 (vote-submission helper consolidation).
  - Added shared helper modules:
    - `web/src/lib/basic-polls/vote-submission.js`
    - `functions/src/basic-polls/vote-submission.js`
  - Replaced duplicated vote-submission logic in:
    - `web/src/lib/data/basicPolls.js`
    - `web/src/features/dashboard/components/group-basic-poll-modal.jsx`
    - `functions/src/basic-polls/callables.js`
    - `functions/src/basic-polls/required-summary.js`
    - `functions/src/triggers/basic-polls.js`
    - `functions/src/triggers/basic-poll-card.js`
    - `functions/src/legacy.js`
  - Added helper unit tests:
    - `web/src/lib/basic-polls/vote-submission.test.js`
    - `functions/src/basic-polls/vote-submission.test.js`
  - Validation:
    - `npm --prefix web run test -- src/lib/basic-polls/vote-submission.test.js src/lib/data/basicPolls.test.js src/features/dashboard/DashboardPage.test.jsx` (pass, `40 passed`, exit code `0`)
    - `npm --prefix functions run test -- src/basic-polls/vote-submission.test.js src/basic-polls/required-summary.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js src/triggers/basic-poll-card.test.js src/legacy.helpers.test.js` (pass, `58 passed`, exit code `0`)

- 2026-02-12: Expanded Code Health Pt2 planning docs with a dedicated dependency re-evaluation phase:
  - Updated `docs/code-health-audit-pt2.md` to include explicit adopt/reject criteria for selectively reintroducing removed/optional libraries (`react-hook-form`, `zod`, `@hookform/resolvers`, `@testing-library/jest-dom`, `msw`, `framer-motion`) and to capture additional library opportunities discovered during refactors.
  - Updated `docs/code-health-audit-pt2-tasks.md` with new Phase 7 (dependency re-evaluation + selective re-introduction) and shifted closeout to Phase 8.

- 2026-02-12: Started executing `docs/code-health-audit-pt2-tasks.md` on branch `feature/code-health-audit-pt2`.
  - Completed Phase 1 (dead/orphaned code + dependency hygiene):
    - Removed orphaned files:
      - `web/src/features/dashboard/components/pending-invite-dialog.jsx`
      - `web/src/lib/data/mail.js`
      - `web/src/lib/emailTemplates.js`
      - `functions/src/notifications/rules.js`
    - Removed unused web dependencies:
      - `@hookform/resolvers`, `@react-oauth/google`, `framer-motion`, `react-hook-form`, `zod`
      - dev: `@testing-library/jest-dom`, `msw`
  - Validation:
    - `npm --prefix web run test` (pass, `327 passed`, exit code `0`)
    - `npm --prefix functions run test` (pass, `350 passed`, exit code `0`)
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`)
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`)
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`)
    - `npm --prefix web run build` (pass, exit code `0`)

- 2026-02-12: Added execution tracker for Code Health Audit Pt 2:
  - `docs/code-health-audit-pt2-tasks.md`
  - Includes phased remediation tasks, acceptance criteria, and validation gates aligned to `docs/code-health-audit-pt2.md`.

- 2026-02-12: Added second-pass repository audit doc:
  - `docs/code-health-audit-pt2.md`
  - Covered duplication, dead/orphaned code, reliability/code-smell hotspots, under-tested areas, third-party replacement opportunities, and extensibility/composability risks with file-linked evidence.
  - Evidence inputs included `jscpd`, `knip` (web/functions), hotspot size scans, and targeted source grep sweeps.

- 2026-02-12: Dashboard general poll card stat-row alignment tweak:
  - `web/src/components/polls/poll-participant-summary.jsx` now renders `Invitees` on its own row, with `Voted` and `Pending` grouped on the same row for better scanability and visual consistency.
  - Validation:
    - `npm --prefix web run test -- src/components/polls/poll-participant-summary.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `12 passed`, exit code `0`).

- 2026-02-12: Added poll unification planning docs:
  - `docs/poll-unification-prettifying-plan.md`
  - `docs/poll-unification-prettifying-task-list.md`
  - Scope covers shared poll UI primitives, Discord sync internals consolidation, session/general parity improvements, and phased validation gates.

- 2026-02-12: Poll unification implementation kickoff (Phase 1.3 + 3.1 slice):
  - Added shared markdown renderer + shared option-note dialog primitives:
    - `web/src/components/polls/poll-markdown-content.jsx`
    - `web/src/components/polls/poll-option-note-dialog.jsx`
  - Replaced duplicated markdown rendering wrappers in scheduler/basic-poll create/edit/view surfaces.
  - Applied shared markdown rendering to session poll description (scheduler detail header).
  - Replaced duplicated option-note modal markup in scheduler and dashboard general poll modal.
  - Added tests:
    - `web/src/components/polls/poll-markdown-content.test.jsx`
    - `web/src/components/polls/poll-option-note-dialog.test.jsx`
  - Validation:
    - `npm --prefix web run test -- src/components/polls/poll-markdown-content.test.jsx src/components/polls/poll-option-note-dialog.test.jsx src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `19 passed`, exit code `0`).

- 2026-02-12: Poll unification milestone 2 (participant + Discord parity primitives):
  - Added shared participant summary + Discord metadata row components:
    - `web/src/components/polls/poll-participant-summary.jsx`
    - `web/src/components/polls/poll-discord-meta-row.jsx`
  - Replaced duplicated avatar/count row rendering in basic poll card surfaces.
  - Added participant avatar summary and Discord metadata visibility in both:
    - scheduler session poll header context
    - dashboard general poll modal context
  - Added tests:
    - `web/src/components/polls/poll-participant-summary.test.jsx`
    - `web/src/components/polls/poll-discord-meta-row.test.jsx`
  - Validation:
    - `npm --prefix web run test -- src/components/polls/poll-participant-summary.test.jsx src/components/polls/poll-discord-meta-row.test.jsx src/components/polls/poll-markdown-content.test.jsx src/components/polls/poll-option-note-dialog.test.jsx src/features/dashboard/DashboardPage.test.jsx src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx` (pass, `25 passed`, exit code `0`).
    - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-12: Poll unification milestone 3 (shared backend Discord sync internals):
  - Added shared Discord sync helper module:
    - `functions/src/discord/sync-core.js`
  - Refactored both trigger pipelines to use shared queue/hash/url helpers:
    - `functions/src/triggers/basic-poll-card.js`
    - `functions/src/triggers/scheduler.js`
  - Added helper unit tests:
    - `functions/src/discord/sync-core.test.js`
  - Updated trigger helper test mocks for queue helper dependency:
    - `functions/src/triggers/scheduler.helpers.test.js`
  - Validation:
    - `npm --prefix functions run test -- src/discord/sync-core.test.js src/triggers/basic-poll-card.test.js src/triggers/scheduler.helpers.test.js src/triggers/scheduler.test.js` (pass, `31 passed`, exit code `0`).
    - `npm --prefix web run test -- src/components/polls/poll-discord-meta-row.test.jsx src/components/polls/poll-participant-summary.test.jsx src/components/polls/poll-markdown-content.test.jsx src/components/polls/poll-option-note-dialog.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `20 passed`, exit code `0`).
    - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-12: Poll unification validation hardening + full gate pass:
  - `web/e2e/playwright.config.js`:
    - Disabled `fullyParallel` and defaulted local `workers` to `1` (with `E2E_WORKERS` override) to eliminate shared-state e2e flakes in emulator runs.
  - Full validation gate:
    - `npm --prefix web run test` (pass, `68 files`, `327 passed`, exit code `0`).
    - `npm --prefix functions run test` (pass, `46 files`, `350 passed`, exit code `0`).
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`).
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; expected emulator warnings only).
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`).

- 2026-02-12: Poll unification staging deploy:
  - `./scripts/deploy-staging.sh` (pass).
  - Staging URL: `https://quest-scheduler-stg.web.app`.

- 2026-02-12: Removed legacy poll-create command fallback:
  - `functions/src/discord/worker.js`:
    - `handlePollCreate` now requires subcommand `multiple` or `ranked`.
    - Removed legacy mode fallback parsing from flat payloads.
  - `functions/src/discord/error-messages.js`:
    - Added `pollCreateSubcommandRequired` guidance message.
  - `functions/src/discord/worker.poll-create.test.js`:
    - Added regression test ensuring legacy payload (no subcommand) is rejected.
    - Updated ranked constraint test to use subcommand-shaped payload.
  - Validation/deploy:
    - `npm --prefix functions run test -- src/discord/worker.poll-create.test.js src/discord/error-messages.test.js src/discord/worker.basic-poll.test.js` (pass, `17 passed`, exit code `0`).
    - `firebase deploy --project default --only functions:processDiscordInteraction` (pass).
    - `firebase deploy --project staging --only functions:processDiscordInteraction` (pass).

- 2026-02-12: Discord basic poll card link UX fix:
  - `functions/src/discord/basic-poll-card.js`:
    - Added embed field `View on web` with markdown link: `[Open poll](<url>)` for clickable navigation in Discord embeds.
    - Replaced footer URL text with neutral footer text (`Quest Scheduler`) to avoid non-clickable URL confusion.
  - `functions/src/discord/basic-poll-card.test.js`:
    - Added assertions verifying `View on web` field link output for open and finalized cards.
  - Validation/deploy:
    - `npm --prefix functions run test -- src/discord/basic-poll-card.test.js src/discord/worker.basic-poll.test.js src/discord/worker.poll-create.test.js` (pass, `17 passed`, exit code `0`).
    - `firebase deploy --project default --only functions:processDiscordInteraction,functions:processDiscordBasicPollUpdate` (pass).
    - `firebase deploy --project staging --only functions:processDiscordInteraction,functions:processDiscordBasicPollUpdate` (pass).

- 2026-02-12: Discord `/poll-create` subcommand migration:
  - `functions/scripts/register-discord-commands.js`:
    - Replaced flat `/poll-create` options with subcommands:
      - `/poll-create multiple` (`title`, `options`, `multi`, `allow_other`, `deadline`)
      - `/poll-create ranked` (`title`, `options`, `deadline`)
  - `functions/src/discord/worker.js`:
    - Added subcommand-aware option parsing (`getCommandInvocation`, `getCommandSubcommand`) while preserving legacy fallback.
    - Updated poll-create mode resolution to honor subcommands and prevent invalid ranked option combinations.
  - `functions/src/discord/worker.poll-create.test.js`:
    - Updated tests to submit subcommand-shaped payloads.
    - Added ranked-subcommand assertion verifying ranked defaults (`allowMultiple: false`, `allowWriteIn: false`).
  - Validation/deploy/register:
    - `npm --prefix functions run test -- src/discord/worker.poll-create.test.js src/discord/worker.basic-poll.test.js src/discord/worker.test.js` (pass, `24 passed`, exit code `0`).
    - `firebase deploy --project default --only functions:processDiscordInteraction` (pass).
    - `firebase deploy --project staging --only functions:processDiscordInteraction` (pass).
    - `node functions/scripts/register-discord-commands.js --global` (pass).
    - `node functions/scripts/register-discord-commands.js --guild 701183788851396738` (pass).
    - `node functions/scripts/register-discord-commands.js --guild 693865335425859675` (pass).

- 2026-02-12: Discord ranked basic-poll voting hotfix:
  - Root cause from production logs (`processDiscordInteraction`):
    - `When querying a collection group and ordering by FieldPath.documentId() ... contains an odd number of segments.`
    - Triggered by `loadGroupBasicPollById` querying `collectionGroup("basicPolls")` with `documentId == pollId`.
  - Fix:
    - `functions/src/discord/worker.js`:
      - Replaced invalid documentId collection-group lookup with:
        - primary lookup via linked questing group (`discord.channelId`/`guildId`) then direct `questingGroups/{groupId}/basicPolls/{pollId}` fetch
        - fallback metadata lookup (`discord.messageId` then `discord.channelId`) and in-memory poll-id match
      - Updated callsites to pass `interaction` into poll resolution.
  - Test coverage:
    - `functions/src/discord/worker.basic-poll.test.js`:
      - Added regression guard that fails if `__name__`/documentId collection-group query is used for this flow.
  - Validation/deploy:
    - `npm --prefix functions run test -- src/discord/worker.basic-poll.test.js src/discord/worker.poll-create.test.js src/discord/worker.test.js` (pass, `24 passed`, exit code `0`).
    - `firebase deploy --project default --only functions:processDiscordInteraction` (pass).
    - `firebase deploy --project staging --only functions:processDiscordInteraction` (pass).

- 2026-02-12: Merge/deploy completion + Firestore index cleanup:
  - Merged `feature/basic-poll-dashboard-ux` into `master`.
  - Resolved deploy-time Firestore index API rejections by removing unnecessary composite indexes from `firestore.indexes.json`:
    - removed `basicPolls(order, __name__)`
    - removed `votes(updatedAt, __name__)`
  - Deploy results:
    - `./scripts/deploy-staging.sh` â†’ pass (`https://quest-scheduler-stg.web.app`).
    - `./scripts/deploy-prod.sh` â†’ pass (`https://studio-473406021-87ead.web.app`).

- 2026-02-12: Full validation sweep + e2e stability hardening:
  - `web/e2e/basic-poll-dashboard-embedded.spec.js`:
    - Added resilient dashboard-card click helper to handle transient detach/re-render timing in poll cards.
    - Hardened auth/login helper (`domcontentloaded`, visible field waits, `/auth` exit assertion) and raised per-test timeout to reduce emulator timing flake.
  - Validation:
    - `npm --prefix web run test` (pass, `64 files`, `316 passed`, exit code `0`).
    - `npm --prefix functions run test` (pass, `45 files`, `344 passed`, exit code `0`).
    - `npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`).
    - `npm --prefix web run test:integration` (pass, `11 passed`, exit code `0`; expected emulator warnings only).
    - `npm --prefix web run test:e2e:emulators` (pass, `49 passed`, `75 skipped`, exit code `0`).

- 2026-02-12: Latest modal/calendar polish + staging deploy:
  - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`:
    - Replaced `+ Customization` label with `Settings`.
    - Removed options-header `+ Add option` button and added centered inline footer actions: `+ Option | + Other`.
    - Simplified ranked-choice help icon treatment (single icon, no extra outer circle wrapper).
  - `web/src/components/ui/calendar.jsx`:
    - Reworked day-picker layout classes so month caption remains centered with previous/next arrows visually aligned around the month header.
    - Improved horizontal centering behavior across month grid/week rows.
  - Validation and deploy:
    - `npm --prefix web run test -- src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `12 passed`, exit code `0`).
    - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).
    - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; hosting deployed to `https://quest-scheduler-stg.web.app`).

- 2026-02-12: Modal customization-chip and calendar navigation pass:
  - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`:
    - Simplified vote-type selector to `Multiple choice` and `Ranked choice`.
    - Added `+ Customization` popover for multiple-choice settings.
    - Added removable customization chips:
      - `Allow multiple`
      - `Max selections: N`
    - Added validation: max selections must be `> 2` and `< total option count`.
    - Hid max-selection controls unless `Allow multiple` is enabled.
  - `web/src/components/ui/calendar.jsx`:
    - Repositioned previous/next arrows inside the month header area.
    - Centered calendar month layout horizontally.
  - Added/updated tests:
    - `web/src/features/basic-polls/components/CreateGroupPollModal.test.jsx` (chip removal and max-selection bound validation).
- 2026-02-12: Validation for customization-chip/calendar pass:
  - `npm --prefix web run test -- src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `12 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-12: Follow-up modal UX refinement based on review feedback:
  - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`:
    - Returned modal to compact single-column layout.
    - Replaced deadline `datetime-local` field with optional deadline chip + themed popover editor (calendar + time).
    - Moved voting setup controls into the Options panel header via styled dropdown selector.
    - Added ranked-choice help as hover tooltip instead of inline explanatory block.
    - Moved multiple-choice controls into the Options header and added `+ Write-in option` flow that toggles an explicit removable write-in row.
- 2026-02-12: Validation for compact modal follow-up:
  - `npm --prefix web run test -- src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-12: Streamlined and restyled General Poll create/edit modal UX:
  - `web/src/components/ui/simple-modal.jsx`:
    - Added `contentClassName` prop to allow modal width/layout overrides for high-density dialogs.
  - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`:
    - Reworked modal into a wider two-panel structure with clearer information hierarchy.
    - Added polished header with quick context chips (group, vote type, option count).
    - Grouped fields into visual cards (content/options vs voting/deadline settings).
    - Replaced plain vote-type select with a cleaner segmented choice UI.
    - Improved options rows with numeric badges, icon-based reorder controls, and clearer action spacing.
    - Tightened footer/action region for less visual clutter while preserving existing behavior.
- 2026-02-12: Validation for General Poll modal UX refresh:
  - `npm --prefix web run test -- src/features/basic-polls/components/CreateGroupPollModal.test.jsx src/features/dashboard/DashboardPage.test.jsx` (pass, `10 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-12: General poll modal-only flow hardening:
  - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`:
    - Added edit mode support to reuse the create modal for edits (`mode="edit"` + `initialPoll` + `onEdited`).
    - Prefills title/description/options/settings/deadline from existing poll state.
    - Locks questing-group selection in edit mode (no group switch during edit).
    - Persists edits through `updateBasicPoll(...)`.
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Switched general-poll edit action to open the shared edit modal instead of navigating to a dedicated page.
    - Switched group general-poll open behavior to dashboard modal flow (no desktop/mobile route split).
    - Added support for opening a poll modal from dashboard query params (`groupPollGroupId`, `groupPollId`) so legacy links can route into the dashboard modal experience.
  - `web/src/features/dashboard/components/group-basic-poll-modal.jsx`:
    - Replaced `Edit` action navigation with callback-driven edit modal opening in dashboard context.
  - `web/src/App.jsx`:
    - Removed dedicated `GroupPollPage` route rendering.
    - Added protected redirect for `/groups/:groupId/polls/:pollId` to `/dashboard?...` modal params.
  - Removed obsolete dedicated page implementation files:
    - deleted `web/src/features/basic-polls/GroupPollPage.jsx`
    - deleted `web/src/features/basic-polls/GroupPollPage.test.jsx`
  - Added test coverage:
    - `web/src/features/basic-polls/components/CreateGroupPollModal.test.jsx` (edit-mode prefill + locked group + update call).
- 2026-02-12: Validation for modal-only general-poll flow:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/features/basic-polls/components/CreateGroupPollModal.test.jsx` (pass, `10 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-12: Expanded Discord critical-event role notifications and updated settings terminology:
  - `functions/src/notifications/discord.js`:
    - Added Discord routing support for general poll lifecycle events:
      - `BASIC_POLL_CREATED`
      - `BASIC_POLL_FINALIZED`
      - `BASIC_POLL_REOPENED`
      - `BASIC_POLL_REMOVED`
      - `BASIC_POLL_FINALIZED_WITH_MISSING_REQUIRED_VOTES`
    - Added lifecycle coverage hooks for `POLL_CREATED` and `POLL_RESTORED`.
    - Added parent-aware Discord context resolution for `basicPoll` resources (`group` and `scheduler` parents).
    - Added role-mention message builders for critical general poll lifecycle updates.
  - `functions/src/triggers/scheduler.js`:
    - Added delete-time role ping message (respecting group Discord lifecycle setting) in `handleDiscordPollDelete`.
  - `web/src/features/scheduler/SchedulerPage.jsx`:
    - Added lifecycle notification emits for `POLL_CANCELLED` and `POLL_RESTORED` so Discord role pings flow through the notification router for cancel/restore events.
  - `web/src/features/scheduler/CreateSchedulerPage.jsx`:
    - Added `POLL_CREATED` lifecycle notification emit on new session poll creation so Discord role pings fire when a fresh session poll card is posted.
  - `web/src/features/scheduler/utils/poll-lifecycle-notifications.js`:
    - Added `POLL_RESTORED` to the lifecycle event allowlist used for discord-linked no-recipient fallback emission.
  - `web/src/features/scheduler/utils/poll-lifecycle-notifications.test.js`:
    - Added coverage for `POLL_RESTORED` lifecycle emission behavior.
  - `web/src/features/settings/components/GroupCard.jsx`:
    - Renamed `Finalization notification` UI copy to `Channel notification role`.
    - Renamed `Finalization & reschedule updates` toggle copy to `Critical lifecycle updates`.
    - Updated helper descriptions to reflect created/finalized/re-opened/cancelled/deleted coverage.
  - Updated tests:
    - `functions/src/notifications/discord.test.js`
    - `functions/src/triggers/scheduler.test.js`
- 2026-02-12: Validation for Discord notification-role coverage and copy updates:
  - `npm --prefix functions run test -- src/notifications/discord.test.js src/triggers/scheduler.test.js` (pass, `20 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/settings/components/GroupCard.test.jsx src/features/scheduler/utils/poll-lifecycle-notifications.test.js` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Removed poll logic from Questing Groups cards:
  - `web/src/features/settings/components/GroupCard.jsx`:
    - Removed group poll subscriptions, vote-count subscriptions, and poll helper state/functions.
    - Removed poll UI section (`Polls`, `Open polls`, `Recent finalized`) and removed `Create poll` action/modal usage.
  - `web/src/features/settings/components/GroupCard.test.jsx`:
    - Removed poll subscription/auth mocks and poll-specific tests.
    - Added regression assertion that poll sections/actions are absent on group cards.
- 2026-02-11: Validation for Questing Groups poll cleanup:
  - `npm --prefix web run test -- src/features/settings/components/GroupCard.test.jsx` (pass, `3 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/settings/SettingsPage.test.jsx` (pass, `3 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Adjusted date-range popover layout:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Moved the date filter `Clear` action into the header row beside `DATE RANGE` to keep the popover compact and avoid an extra row.
- 2026-02-11: Validation for date-range popover layout tweak:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Polished dashboard filter chips and date-range editor:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Centered chip labels horizontally/vertically within filter chips.
    - Added defensive date-range normalization so start/end ordering is always valid for filtering/display.
    - Increased date filter popover width and date field minimum widths to prevent wrapping.
  - `web/src/components/ui/date-picker.jsx`:
    - Added `whitespace-nowrap` to prevent dates wrapping onto multiple lines in compact contexts.
- 2026-02-11: Validation for dashboard filter chip/date-range polish:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Fixed dashboard filter-chip add flow regression:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Added first-dismiss guard for newly added filter chips so the editor popover stays open after selecting a filter from `+ Filter`.
    - Preserved close-on-empty behavior once the user explicitly dismisses an untouched pending filter.
- 2026-02-11: Validation for dashboard filter-chip add flow regression fix:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Refined chip-filter editing UX to use popover overlays and immediate-save behavior:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Removed inline expanding filter editor panel under the filter bar.
    - Replaced chip editing with popover overlays matching the `+ Filter` add-filter interaction.
    - Removed Apply buttons; filter changes now apply immediately as selections are made.
    - Added pending-chip close behavior: if a newly added filter remains empty when dismissed, the chip disappears.
    - Preserved compact desktop one-line layout and mobile wrapping behavior.
- 2026-02-11: Validation for popover immediate-save filter UX:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/dashboard` (pass, `20 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Reworked dashboard filtering to chip-based add/edit/remove UX:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Kept free-text search and replaced static controls with dynamic filter chips plus a `+ Filter` chip.
    - Added add-filter picker (`Questing group`, `Status`, `Date range`) with animated reveal behavior.
    - Added compact read-only chips that summarize active filters and reopen pre-filled editors when clicked.
    - Added hover remove affordance (`x`) on chips to remove filters quickly.
    - Added animated inline editor panels for group/status/date filters with apply/cancel semantics.
    - Kept desktop one-line layout behavior and mobile wrap behavior (chips above search when needed).
  - Filtering behavior remains unified across session polls and general polls.
- 2026-02-11: Validation for chip-based dashboard filter UX:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/dashboard` (pass, `20 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Implemented compact dashboard filter bar and unified filtering across session + general polls:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Replaced the old titled dashboard filter block with a compact inline filter bar.
    - Added colorized questing-group selector using the selected group color.
    - Added free-text search (title + description) applied to both session polls and general polls.
    - Added unified status multi-select (`Open`, `Finalized`, `Cancelled`, `Closed`, `Archived`) applied to both session and general poll datasets.
    - Added date-window filtering (`From` / `To`) for both session and general polls.
    - Added clear-all filters action and filter-state summaries.
    - Wired filter start date to the session calendar focus date.
  - `web/src/features/dashboard/components/DashboardCalendar.jsx`:
    - Added `focusedDate` prop and synchronization effect so dashboard date-filter start updates calendar visible date/month.
  - `web/src/features/dashboard/DashboardPage.test.jsx`:
    - Added coverage for text-filter behavior across session/general poll cards.
    - Added coverage for status + date filter behavior across session/general poll cards.
- 2026-02-11: Validation for compact dashboard filter bar updates:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `9 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Implemented dashboard questing-group filter + dashboard general-poll creation flow:
  - `web/src/features/dashboard/DashboardPage.jsx`:
    - Added dashboard-level questing-group selector (`Dashboard filter`) that scopes session and general-poll lists to a selected group.
    - Added `+ New poll` action to the `General Polls` section (visible for questing-group members, enabled for group managers).
    - Wired dashboard create flow via `CreateGroupPollModal` and post-create dashboard refresh.
    - Added refresh nonce path so create/finalize/reopen/delete actions refresh dashboard general-poll sources.
  - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`:
    - Added dashboard mode with selectable questing group (reusing scheduler `QuestingGroupSelect` dropdown).
    - Preserved existing fixed-group settings flow behavior.
  - `web/src/features/scheduler/components/questing-group-select.jsx`:
    - Added optional `showNoneOption` prop for required-selection contexts.
  - Updated coverage:
    - `web/src/features/dashboard/DashboardPage.test.jsx`
    - `web/e2e/basic-poll-dashboard-embedded.spec.js` (dashboard card behavior alignment + create-from-dashboard flow)
- 2026-02-11: Validation for dashboard filter/create updates:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx` (pass, `7 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/features/settings/SettingsPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `37 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/basic-polls/callables.test.js src/triggers/basic-poll-card.test.js` (pass, `26 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warning).
  - `set -a; source web/.env.e2e.local; set +a; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node functions/scripts/seed-e2e-scheduler.js && npm --prefix web run test:e2e -- e2e/basic-poll-dashboard-embedded.spec.js"` (pass; `2 passed`, `6 skipped`, exit code `0`).

- 2026-02-11: Deployed current workspace state to staging after timezone-label fix:
  - Command: `DEPLOY_ONLY=hosting,functions,storage,firestore:rules ./scripts/deploy-staging.sh`
  - Result: deploy succeeded (hosting release complete, functions updated, storage/firestore rules released).
  - Staging URL: `https://quest-scheduler-stg.web.app`

- 2026-02-11: Fixed auto-convert timezone label regression affecting Pacific/Auckland:
  - Root cause: timezone label parsing extracted uppercase letters and collapsed values like `GMT+13` into `GMT`.
  - Updated `web/src/lib/time.js` and `functions/src/discord/time-utils.js` to use the formatter-provided short timezone token directly with whitespace normalization only.
  - Added regression tests:
    - `web/src/lib/time.test.js`
    - `functions/src/discord/time-utils.test.js`
- 2026-02-11: Validation for timezone label regression fix:
  - `npm --prefix web run test -- src/lib/time.test.js` (pass, `6 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/discord/time-utils.test.js src/discord/poll-card.test.js` (pass, `5 passed`, exit code `0`).

- 2026-02-11: Applied General Polls terminology + action-menu UX pass:
  - Dashboard card copy updated from `Basic Polls` to `General Polls` and subtitle shortened to `Standalone and add-on polls.`.
  - Added kebab menus to dashboard general poll cards (`web/src/components/polls/basic-poll-card.jsx`) with operations:
    - archive/unarchive
    - re-open (when finalized)
    - finalize (when open)
    - edit
    - delete
  - Wired dashboard action handlers in `web/src/features/dashboard/DashboardPage.jsx` for finalize/reopen/delete/edit across group + scheduler parent poll types.
  - Updated dashboard modal (`web/src/features/dashboard/components/group-basic-poll-modal.jsx`) so:
    - archive/unarchive is a dedicated header button
    - re-open is a dedicated header button (when finalized)
    - kebab menu includes finalize/edit/delete
  - Kept shared poll rendering centralized via `web/src/components/polls/basic-poll-voting-card.jsx` and reused in both scheduler and dashboard modal.
  - Renamed session-page embedded poll wording to add-on wording and changed add-on poll list to 2-column layout in `web/src/features/scheduler/SchedulerPage.jsx`.
  - Updated create/edit flow wording to add-on wording in `web/src/features/scheduler/CreateSchedulerPage.jsx`.
  - Updated notification preference labels in settings from basic-poll naming to general-poll naming in `web/src/features/settings/SettingsPage.jsx`.
- 2026-02-11: Validation for General Polls copy + menu/actions + add-on layout pass:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js src/features/settings/SettingsPage.test.jsx src/features/scheduler/components/finalize-embedded-polls-choice-dialog.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx` (pass, `38 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).
  - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; hosting released).
  - Staging URL: `https://quest-scheduler-stg.web.app`

- 2026-02-11: Implemented group basic-poll modal flow from dashboard and unified poll-card widgeting:
  - Added shared card component `web/src/components/polls/basic-poll-voting-card.jsx` extracted from scheduler embedded poll UI.
  - Refactored `web/src/features/scheduler/SchedulerPage.jsx` embedded poll list to render via `BasicPollVotingCard`.
  - Added `web/src/features/dashboard/components/group-basic-poll-modal.jsx` to render group polls in an in-dashboard desktop modal using the same voting card widget as embedded scheduler polls.
  - Updated `web/src/features/dashboard/DashboardPage.jsx`:
    - group basic polls open modal on desktop
    - mobile still navigates to route (`/groups/:groupId/polls/:pollId`)
  - Updated `web/src/components/polls/basic-poll-card.jsx` to support custom `onOpen` callback.
  - Added modal-open regression test in `web/src/features/dashboard/DashboardPage.test.jsx`.
- 2026-02-11: Validation for dashboard group-poll modal + shared basic poll voting card:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `32 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).
  - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; hosting released).
  - Staging URL: `https://quest-scheduler-stg.web.app`

- 2026-02-11: Updated dashboard basic-poll interaction model to match session cards:
  - Removed inline `Vote/Edit vote/View results` button from `web/src/components/polls/basic-poll-card.jsx`.
  - Made entire basic-poll card clickable + keyboard accessible (`role="button"`, `Enter`/`Space`) with navigate/fallback behavior consistent with session cards.
  - Preserved archive/unarchive icon action and prevented navigation on archive button click via `stopPropagation`.
  - Updated assertions in `web/src/features/dashboard/DashboardPage.test.jsx` for card-level action label (`Edit vote: <title>`) instead of link buttons.
- 2026-02-11: Validation for basic-poll whole-card navigation update:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `31 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Improved dashboard basic-poll cards to align with session poll card UX:
  - Updated `web/src/components/polls/basic-poll-card.jsx` to mirror session-card interaction language:
    - card hover/lift motion (`hover:scale` + shadow)
    - white elevated card surface and shared spacing rhythm
    - title row chips aligned to session-card patterns
    - cleaner meta line (`context â€¢ deadline`)
    - avatar rows now use session-style copy and layout (`invitees`, `voted`, `pending`, `All voted!`)
  - Updated `web/src/features/dashboard/DashboardPage.jsx` to pass context accent color to basic-poll cards:
    - group polls use questing-group color
    - embedded polls use parent scheduler questing-group color when available
- 2026-02-11: Validation for basic-poll/session-card UX alignment pass:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `31 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Fixed dashboard basic-poll loading loop/regression on `feature/basic-poll-dashboard-ux`:
  - Root cause: basic-poll fetch effect depended on unstable derived objects/maps (`schedulerMetaById`, group maps, archived state), causing repeated fetches and `basicPollLoading` flip-flopping.
  - Refactor in `web/src/features/dashboard/DashboardPage.jsx`:
    - fetches now write only to `basicPollSourceItems` based on stable query keys
    - card state/classification is derived via `useMemo` from source items + local metadata
  - Added regression assertion in `web/src/features/dashboard/DashboardPage.test.jsx` to ensure a no-data render path performs only one fetch for each dashboard basic-poll source.
- 2026-02-11: Validation for dashboard basic-poll loading-loop fix:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `31 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warnings).

- 2026-02-11: Implemented dashboard basic-poll UX refresh on branch `feature/basic-poll-dashboard-ux`:
  - Added reusable card component `web/src/components/polls/basic-poll-card.jsx` with status chips, poll-type badges, voting avatar stacks, and archive/unarchive actions.
  - Expanded dashboard data loaders in `web/src/lib/data/basicPolls.js` to fetch and normalize both group basic polls and embedded scheduler basic polls for tabbed dashboard views.
  - Refactored `web/src/features/dashboard/DashboardPage.jsx` to render a new `Basic Polls` section with tabs (`Needs vote`, `Open voted`, `Closed`, `Archived`) and shared card rendering.
  - Updated coverage in:
    - `web/src/lib/data/basicPolls.test.js`
    - `web/src/features/dashboard/DashboardPage.test.jsx`
- 2026-02-11: Validation and deploy for dashboard basic-poll UX refresh:
  - `npm --prefix web run test -- src/features/dashboard/DashboardPage.test.jsx src/lib/data/basicPolls.test.js` (pass, `31 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warning).
  - `./scripts/deploy-staging.sh` (fails on Firestore index sync: HTTP `400` "this index is not necessary, configure using single field index controls").
  - `DEPLOY_ONLY=hosting ./scripts/deploy-staging.sh` (pass; hosting released successfully).
  - Staging URL: `https://quest-scheduler-stg.web.app`

- 2026-02-11: Implemented independent embedded-poll finalize/reopen controls for scheduler polls and updated scheduler finalization UX:
  - Scheduler creators can now finalize or reopen any embedded poll individually from the embedded poll card (`Finalize poll` / `Re-open poll`).
  - Finalizing a session winner now prompts when unfinalized embedded polls exist: choose `Finalize session only` or `Finalize session + embedded polls`.
  - If `Finalize session only` is chosen, scheduler finalizes while embedded polls remain votable until individually finalized.
  - Backend callable support now includes scheduler parent paths for poll finalize/reopen (`finalizeBasicPoll`, `reopenBasicPoll`).
  - Firestore rules now allow embedded poll voting when scheduler is `FINALIZED` as long as embedded poll is `OPEN`, deadline not passed, and scheduler is not `CANCELLED`.
- 2026-02-11: Validation for embedded poll independent finalize/reopen flow:
  - `npm --prefix functions run test -- src/basic-polls/callables.test.js` (pass, `19 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/scheduler/components/finalize-embedded-polls-choice-dialog.test.jsx` (pass, `26 passed`, exit code `0`).
  - `XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`).
  - `firebase emulators:exec --only auth,functions,firestore,storage "npm --prefix web run test -- --config vitest.integration.config.js --run src/__tests__/integration/basic-polls.integration.test.js"` (pass, exit code `0`; emulator logs include unrelated notification trigger noise but suite completed successfully).
  - `set -a; source web/.env.e2e.local; set +a; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node functions/scripts/seed-e2e-scheduler.js && npm --prefix web run test:e2e -- e2e/basic-poll-embedded-finalize-controls.spec.js"` (pass, `2 passed`, `6 skipped`, exit code `0`).

- 2026-02-11: Re-pushed staging after Tailwind typography plugin enablement for markdown rendering:
  - Command: `DEPLOY_ONLY=hosting,functions,storage,firestore:rules ./scripts/deploy-staging.sh`
  - Result: deploy succeeded; hosting released, unchanged functions skipped.
  - Staging URL: `https://quest-scheduler-stg.web.app`

- 2026-02-11: Fixed markdown styling (headings/emphasis/link appearance) for all ReactMarkdown surfaces:
  - Root cause: `@tailwindcss/typography` plugin was not installed/configured, so `prose` classes had no generated styles.
  - Added dependency: `@tailwindcss/typography` in `web/package.json`.
  - Updated `web/tailwind.config.js` to include `tailwindTypography` plugin.
  - Standardized markdown wrapper classes across basic-poll and embedded-poll components to use:
    - `prose prose-sm prose-slate ... dark:prose-invert`
    - explicit link styling via `prose-a:text-brand-primary prose-a:underline`.
  - Affected files:
    - `web/src/features/basic-polls/GroupPollPage.jsx`
    - `web/src/features/basic-polls/components/CreateGroupPollModal.jsx`
    - `web/src/features/scheduler/SchedulerPage.jsx`
    - `web/src/features/scheduler/components/EmbeddedPollEditorModal.jsx`
- 2026-02-11: Validation for markdown styling fix:
  - `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx` (pass, `16 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warning).

- 2026-02-11: Re-pushed latest markdown/note-view fixes to staging:
  - Command: `DEPLOY_ONLY=hosting,functions,storage,firestore:rules ./scripts/deploy-staging.sh`
  - Result: deploy succeeded (hosting, functions, storage rules, firestore rules).
  - Staging URL: `https://quest-scheduler-stg.web.app`

- 2026-02-11: Fixed basic-poll markdown rendering + option-note visibility regressions in both standalone and embedded poll views:
  - Updated `web/src/features/basic-polls/GroupPollPage.jsx`:
    - Rendered poll description markdown in read mode via `ReactMarkdown` + `remark-gfm`.
    - Added read-mode `View note` affordances across vote/results rows and a scrollable markdown note modal.
  - Updated `web/src/features/scheduler/SchedulerPage.jsx`:
    - Rendered embedded poll descriptions as markdown in scheduler vote cards.
    - Added embedded poll `View note` actions (multiple-choice, ranked, and finalized/result rows) with a read-only markdown note modal.
  - Added/updated coverage:
    - `web/src/features/basic-polls/GroupPollPage.test.jsx` now covers read-mode markdown description rendering and option-note modal rendering.
    - `web/e2e/basic-poll-dashboard-embedded.spec.js` now validates opening/closing an embedded option-note modal from a deep-linked scheduler poll.
    - `functions/scripts/seed-e2e-scheduler.js` now seeds markdown description + option note for the dashboard embedded poll fixture.
- 2026-02-11: Validation for markdown + option-note fixes:
  - `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx` (pass, `16 passed`, exit code `0`).
  - `set -a; source web/.env.e2e.local; set +a; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node functions/scripts/seed-e2e-scheduler.js && npm --prefix web run test:e2e -- e2e/basic-poll-dashboard-embedded.spec.js"` (pass, chromium `1 passed`; non-chromium projects skipped by spec guard).

- 2026-02-11: Added E2E coverage for embedded poll management on scheduler edit pages:
  - Added dedicated seed fixtures in `functions/scripts/seed-e2e-scheduler.js`:
    - `E2E_EMBEDDED_EDITOR_SCHEDULER_ID` (`e2e-embedded-editor-scheduler`)
    - `E2E_EMBEDDED_EDITOR_POLL_ID` (`e2e-embedded-editor-existing-poll`)
  - Added Playwright spec `web/e2e/basic-poll-embedded-editor.spec.js` covering:
    - add embedded poll
    - edit embedded poll (including required/optional toggle)
    - remove embedded poll
    - modify an existing embedded poll
- 2026-02-11: Validation for embedded poll editor E2E coverage:
  - `set -a; source web/.env.e2e.local; set +a; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node functions/scripts/seed-e2e-scheduler.js && npm --prefix web run test:e2e -- e2e/basic-poll-embedded-editor.spec.js"` (pass; chromium `1 passed`, non-chromium projects skipped by spec guard).

- 2026-02-11: Added E2E coverage for embedded polls in scheduler `/create` flow:
  - Added Playwright spec `web/e2e/basic-poll-embedded-create.spec.js` covering:
    - create scheduler from `/create`
    - add embedded poll before submit
    - create session poll
    - verify embedded poll persists on resulting scheduler edit page
- 2026-02-11: Validation for embedded poll create-flow E2E coverage:
  - `set -a; source web/.env.e2e.local; set +a; firebase emulators:exec --only auth,firestore,functions,storage --log-verbosity SILENT "node functions/scripts/seed-e2e-scheduler.js && npm --prefix web run test:e2e -- e2e/basic-poll-embedded-create.spec.js"` (pass; chromium `1 passed`, non-chromium projects skipped by spec guard).

- 2026-02-11: Fixed create-mode embedded poll authoring on `Create Session Poll`:
  - `web/src/features/scheduler/CreateSchedulerPage.jsx` now shows the Embedded polls section in both create and edit flows.
  - Added local draft embedded poll management for create flow (add/edit/remove/reorder before scheduler exists), then persisted drafts immediately after scheduler creation.
  - Existing edit-mode behavior remains server-backed and unchanged.
  - Added helper utilities in `web/src/features/scheduler/utils/embedded-poll-drafts.js`.
  - Added focused unit coverage in `web/src/features/scheduler/utils/embedded-poll-drafts.test.js`.
- 2026-02-11: Validation for create-mode embedded poll fix:
  - `npm --prefix web run test -- src/features/scheduler/utils/embedded-poll-drafts.test.js src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx` (pass, `2 files`, `7 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; existing non-blocking chunk-size warning).

- 2026-02-11: Configured ADC quota project for this environment and removed the prior integration-test blocker:
  - Ran `gcloud auth application-default set-quota-project studio-473406021-87ead` and `gcloud config set billing/quota_project studio-473406021-87ead`.
  - Validation:
    - `jq -r '.quota_project_id // "<missing>"' ~/.config/gcloud/application_default_credentials.json` -> `studio-473406021-87ead`.
    - `npm --prefix web run test:integration` (pass, exit code `0`).

- 2026-02-11: Deployed current app state to staging (`quest-scheduler-stg`):
  - Initial full deploy attempt failed on Firestore indexes:
    - `DEPLOY_ONLY=hosting,functions,firestore,storage ./scripts/deploy-staging.sh`
    - Failure: Firestore index API HTTP 400: "this index is not necessary, configure using single field index controls".
  - Successful retry with Firestore rules only:
    - `DEPLOY_ONLY=hosting,functions,storage,firestore:rules ./scripts/deploy-staging.sh` (pass, exit code `0`).
  - Result:
    - Hosting URL: `https://quest-scheduler-stg.web.app`
    - Functions updated (including basic-poll and notification handlers), hosting released, storage/firestore rules published.

- 2026-02-11: Completed `basic-poll` Testing Gate A (`A.1`â€“`A.16`) and validated phase 1â€“11 robustness with full test reruns:
  - Stabilized flaky standalone poll E2E by updating `web/e2e/basic-poll-standalone.spec.js` to clear pre-existing user vote state before submit/clear assertions.
  - Confirmed full E2E emulator suite passes after fix.
- 2026-02-11: Test results for Testing Gate A completion:
  - `npm --prefix web run test -- --run` (pass, `62 files`, `312 passed`, exit code `0`).
  - `npm --prefix functions run test -- --run` (pass, `44 files`, `336 passed`, exit code `0`).
  - `XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`).
  - `XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:integration` (fails in this environment: Firebase Extensions API ADC quota-project `403` while reading `extensions`).
  - `XDG_CONFIG_HOME=/tmp/firebase-config firebase emulators:exec --only auth,functions,firestore,storage "npm --prefix web run test -- --config vitest.integration.config.js --run"` (pass, `3 files`, `11 passed`, exit code `0`).
  - `npm --prefix web run test:e2e:emulators` (pass, `46 passed`, `54 skipped`, exit code `0`).
  - `npm --prefix web run test:coverage` (pass; `web/src/lib/basic-polls` `90.78%` lines, `web/src/lib/data/basicPolls.js` `85.2%` lines).
  - `npm --prefix functions run test -- --coverage` (pass; `functions/src/basic-polls` `90.46%` lines, `functions/src/discord` `82.62%` lines, `functions/src/notifications/auto-clear.js` `100%` lines).

- 2026-02-11: Moved all docs marked `status: OBSOLETE` or `implementationStatus: DEPRECATED` into `docs/archived/`:
  - `docs/archived/discord-bot-feature-mvp-prompts.md`
  - `docs/archived/external-feedback/claude-request.md`
  - `docs/archived/external-feedback/claude-response.md`
  - `docs/archived/external-feedback/gemini-request.md`
  - `docs/archived/external-feedback/gemini-response.md`
  - `docs/archived/task-list-archive-2026-01-28.md`
  - `docs/archived/task-list-archive-2026-01-31.md`
  - `docs/archived/task-list-archive-basic-poll-2026-02-11.md`
  - `docs/archived/task-list-archive-unified-notification-overhaul-2026-01-31.md`
- 2026-02-11: Validation for archived-docs move:
  - Verified no obsolete/deprecated docs remain outside `docs/archived/` (pass).
  - Documentation-only file move; runtime tests not run (not applicable).

- 2026-02-11: Re-audited all docs with `implementationStatus: PENDING|ONGOING` after metadata feedback and corrected overstated in-progress statuses:
  - Updated to `COMPLETE` (kept `status: STALE` where appropriate) for completed past design/workstreams:
    - `docs/discord-login-portal.md`
    - `docs/display-names-and-usernames.md`
    - `docs/user-icon-customization.md`
    - `docs/discord-bot-feature-design-doc.md`
    - `docs/discord-bot-feature-design-tasks-list.md`
    - `docs/implementation-plan.md`
    - `docs/uuid_migration_plan.md`
  - Kept `PENDING`/`ONGOING` only for active or genuinely pending streams:
    - `docs/basic-poll.md`, `docs/basic-poll-tasks.md`, `docs/plan-execution/basic-poll-task-list.md`, `docs/task-list.md`
    - `docs/calendar_event_sync_design_doc.md`
    - `docs/typescript-migration-state.md`, `docs/typescript_migraiton_plan.md`
    - `docs/v2-functions-migration-plan.md`
  - Added frontmatter changelog entries and refreshed `lastUpdated` dates on corrected docs.
- 2026-02-11: Validation for pending/ongoing status recheck:
  - `node` frontmatter schema validator across `docs/**/*.md` (pass: `Validated 35 docs.`).
  - Documentation-only metadata correction; runtime tests not run (not applicable).

- 2026-02-11: Completed `basic-poll` task `P2 11.1` (Discord finalize from `poll-create`):
  - Added `handleBasicPollFinalize(...)` in `functions/src/discord/worker.js` and wired `bp_finalize:{pollId}` routing in `processDiscordInteraction`.
  - Implemented finalize flow with:
    - Discord user link resolution and group manager authorization checks
    - poll status guards (`pollAlreadyFinalized`, closed-state handling)
    - ranked-choice tie detection with Discord->web handoff message (`pollTieBreakWeb`)
    - final results snapshot computation (multiple-choice + IRV) and poll finalize write (`status`, `finalizedAt`, `finalizedByUserId`, `finalResults`)
    - finalized card update via `editChannelMessage`
    - channel results post for both MC and RC formats with web results link
    - queued `BASIC_POLL_FINALIZED` and `BASIC_POLL_RESULTS` notification events (Discord source)
  - Added/expanded worker tests in `functions/src/discord/worker.basic-poll.test.js` for:
    - finalize success path (state write + card update + results post + notification enqueue)
    - ranked-choice tie rejection path
    - manager authorization rejection path
- 2026-02-11: Test results for `P2 11.1` validation:
  - `npm --prefix functions run test -- src/discord/worker.basic-poll.test.js` (pass, `7 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/discord/worker.poll-create.test.js src/discord/worker.handlers.test.js src/discord/worker.test.js src/discord/ingress.test.js src/discord/basic-poll-card.test.js` (pass, `33 passed`, exit code `0`).

- 2026-02-11: Completed full `docs/` frontmatter audit across all Markdown docs (`35` files):
  - Added YAML metadata to every `docs/**/*.md` file with: `created`, `lastUpdated`, `summary`, `category`, `status`, `note`, `changelog`, and conditional `implementationStatus`.
  - Derived `created`/`lastUpdated`/`changelog` from `git log --follow` where available; for files with no commit history, used local file timestamp fallback and explicit no-history changelog note.
  - Classified each doc into enum categories (`DESIGN_DOC`, `TASK_TRACKER`, `CORE_DOCUMENTATION`, `RUNBOOK`, `DECISION_LOG`, `TEST_PLAN`, `REFERENCE`) and statuses (`CURRENT`, `STALE`, `OBSOLETE`) using doc content, recency, and alignment with active plans.
  - Added top-of-doc warning callouts for all `STALE` and `OBSOLETE`/`DEPRECATED` docs.
  - Used task manager tracking with one task per doc (35 tasks created and completed under project `Docs frontmatter audit`).
- 2026-02-11: Validation for docs frontmatter audit:
  - `node` schema validation script across all `docs/**/*.md` confirmed required fields + conditional rules + warning callout presence for stale/obsolete files (pass: `Validated 35 docs with no frontmatter schema issues.`).
  - Documentation-only change; runtime tests not run (not applicable).

- 2026-02-11: Completed `basic-poll` tasks `P2 10.1`, `P2 10.2`, and `P2 10.3` (Discord `/poll-create`):
  - `P2 10.1`:
    - Added top-level `/poll-create` command registration in `functions/scripts/register-discord-commands.js` with options for `title`, `options`, `mode`, `multi`, `allow_other`, and `deadline`.
  - `P2 10.2`:
    - Added `handlePollCreate(...)` flow in `functions/src/discord/worker.js` with:
      - Discord user link resolution
      - linked group lookup by `discord.channelId`
      - group manager authorization checks
      - options parsing/validation (2â€“25, pipe-delimited)
      - mode validation (`ranked-choice` + write-in guard)
      - deadline parsing/validation (ISO date + relative `Nd`/`Nw`)
      - basic poll doc creation + Discord card post + Discord metadata write
      - `BASIC_POLL_CREATED` notification event enqueue
      - ephemeral success confirmation with `Edit on Web` link button
  - `P2 10.3`:
    - Added Phase 10 Discord error constants in `functions/src/discord/error-messages.js`:
      - `noLinkedGroupForPoll`, `notGroupManager`, `tooFewOptions`, `tooManyOptionsDiscord`, `writeInNotRanked`, `deadlineInPast`, `pollAlreadyFinalized`, `pollTieBreakWeb`, `basicPollNotFound`, `basicPollClosed`
    - Added focused coverage in `functions/src/discord/worker.poll-create.test.js` for command success and key error paths.
- 2026-02-11: Test results for `P2 10.1` + `P2 10.2` + `P2 10.3` validation:
  - `npm --prefix functions run test -- src/discord/worker.poll-create.test.js` (pass, `5 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/discord/worker.basic-poll.test.js src/discord/worker.handlers.test.js src/discord/worker.test.js src/discord/ingress.test.js src/discord/basic-poll-card.test.js` (pass, `32 passed`, exit code `0`).

- 2026-02-11: Added consistent docs frontmatter metadata policy to `AGENTS.md`, `CLAUDE.md`, and `GEMINI.md`:
  - Required metadata fields for every Markdown file in `docs/`: `created`, `lastUpdated`, `summary`, `category`, `status`, `changelog`, and `note`.
  - Required conditional field: `implementationStatus` for task trackers/TDD/implementation-plan docs.
  - Added shared enum sets for `category`, `status`, and `implementationStatus`.
  - Added lifecycle semantics for `CURRENT`, `STALE`, `OBSOLETE`, and `DEPRECATED`.
  - Added mandatory freshness warning guidance (including `CURRENT` + `lastUpdated > 90 days` warning requirement).
  - Added a minimal frontmatter template and concise changelog format requirements.
- 2026-02-11: Validation for docs metadata policy update:
  - Documentation-only change; no runtime code paths modified.
  - Tests not run (not applicable for this docs-only update).

- 2026-02-11: Completed `basic-poll` tasks `P2 9.1`, `P2 9.2`, `P2 9.3`, and `P2 9.4` (Discord basic poll card + voting + card sync):
  - `P2 9.1`:
    - Added `functions/src/discord/basic-poll-card.js` with open/finalized card builder output (type/status/options/votes/deadline/results/footer), `bp_vote`/`bp_finalize` controls while open, and finalized `View Results` link state.
    - Added card builder tests in `functions/src/discord/basic-poll-card.test.js`.
  - `P2 9.2` + `P2 9.3`:
    - Extended `functions/src/discord/worker.js` with group basic poll voting handlers:
      - multiple-choice: `bp_vote`, `bp_mc_select`, `bp_submit`, `bp_clear`
      - ranked-choice: `bp_vote`, `bp_rank_select`, `bp_rank_prev`, `bp_rank_next`, `bp_rank_undo`, `bp_rank_reset`, `bp_rank_submit`, `bp_clear`
    - Added session model `discordVoteSessions/{discordUserId}:basicPoll:{pollId}` and server-side poll re-fetch/writable validation before vote writes.
    - Updated ingress behavior in `functions/src/discord/ingress.js` so `bp_vote:*` uses ephemeral defer responses.
    - Added tests in `functions/src/discord/worker.basic-poll.test.js` and updated ingress tests.
  - `P2 9.4`:
    - Added `functions/src/triggers/basic-poll-card.js` with poll + vote write enqueue triggers and `processDiscordBasicPollUpdate` queue worker using sync hashes, create/edit card updates, and delete-message handling when polls are removed.
    - Added `DISCORD_BASIC_POLL_TASK_QUEUE` config in `functions/src/discord/config.js`.
    - Exported new trigger module in `functions/src/index.js`.
    - Added trigger tests in `functions/src/triggers/basic-poll-card.test.js`.
- 2026-02-11: Test results for `P2 9.1` + `P2 9.2` + `P2 9.3` + `P2 9.4` validation:
  - `npm --prefix functions run test -- src/discord/basic-poll-card.test.js src/discord/worker.basic-poll.test.js src/discord/ingress.test.js src/triggers/basic-poll-card.test.js` (pass, `20 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/discord/ingress.test.js src/discord/worker.test.js src/discord/worker.vote.test.js src/discord/worker.handlers.test.js src/discord/worker.basic-poll.test.js src/discord/basic-poll-card.test.js src/triggers/basic-polls.test.js src/triggers/basic-poll-card.test.js src/basic-polls/callables.test.js` (pass, `63 passed`, exit code `0`).

- 2026-02-11: Hardened Discord group-channel linking to prevent channel reuse across different questing groups:
  - Added `channelAlreadyLinked` error in `functions/src/discord/error-messages.js`.
  - Updated `functions/src/discord/worker.js` `handleLinkGroup(...)` to reject linking when `discord.channelId` is already linked on another `questingGroups/{groupId}` doc.
  - Added coverage in `functions/src/discord/worker.handlers.test.js` for the conflict path (no link overwrite, clear user-facing error).
- 2026-02-11: Validation for Discord channel-link conflict guard:
  - `npm --prefix functions run test -- src/discord/worker.handlers.test.js src/discord/worker.vote.test.js` (pass, `17 passed`, exit code `0`).

- 2026-02-11: Extended `docs/v2-functions-migration-plan.md` with a new post-migration phase for replacing v1 `onUserCreate` after initial v1->v2 migration stabilizes:
  - Added target architecture (`bootstrapUserProfileV2` callable + client bootstrap + reconciliation job), rollout sequence, acceptance criteria, and rollback plan.
  - Explicitly scoped this as a follow-up phase after initial migration is complete/tested.
- 2026-02-11: Validation for `onUserCreate` migration-plan doc update:
  - Documentation-only change; no runtime code paths modified.
  - Tests not run (not applicable for this docs-only update).

- 2026-02-11: Completed `basic-poll` tasks `P2 4.3`, `P2 4.5`, and `P2 4.6`:
  - `P2 4.3` (`?poll=` embedded poll deep links):
    - Added `parseEmbeddedPollIdFromSearch` utility (`web/src/features/scheduler/utils/embedded-poll-deep-link.js`) and tests.
    - Updated `web/src/features/scheduler/SchedulerPage.jsx` to parse `?poll`, auto-scroll to the targeted embedded poll card, and temporarily highlight it.
    - Updated dashboard embedded poll links to `/scheduler/:id?poll=:pollId` (`web/src/features/dashboard/DashboardPage.jsx`).
  - `P2 4.5` (finalization warning for missing required embedded polls):
    - Added server summary helper `functions/src/basic-polls/required-summary.js`.
    - Added callable `getRequiredEmbeddedPollFinalizeSummary` in `functions/src/basic-polls/callables.js`.
    - Added warning modal `RequiredEmbeddedFinalizeWarningDialog` and integrated finalize pre-check flow in `web/src/features/scheduler/SchedulerPage.jsx` with explicit â€œFinalize anywayâ€.
    - Updated `functions/src/legacy.js` finalization to persist:
      - `finalizedWithMissingRequiredBasicPollVotes`
      - `missingRequiredBasicPollVotesSummary`
      - `missingRequiredBasicPollVotesCapturedAt`
  - `P2 4.6` (clone embedded polls):
    - Updated `functions/src/legacy.js` `cloneSchedulerPoll` to clone embedded poll docs and clone embedded vote docs when votes are retained.
    - Added client fallback clone support for embedded polls via `cloneEmbeddedBasicPolls(...)` (`web/src/lib/data/basicPolls.js`) and integrated it in `web/src/features/scheduler/SchedulerPage.jsx`.
- 2026-02-11: Test results for `P2 4.3` + `P2 4.5` + `P2 4.6` validation:
  - `npm --prefix functions run test -- src/basic-polls/callables.test.js src/legacy.clone.test.js src/legacy.calendar.test.js` (pass, `21 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/dashboard/DashboardPage.test.jsx src/features/scheduler/utils/embedded-poll-deep-link.test.js` (pass, `30 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).

- 2026-02-11: Completed `basic-poll` task `P2 7.3` (required embedded poll callable for `BASIC_POLL_REQUIRED_CHANGED`):
  - Added/validated `notifyBasicPollRequiredChanged` server callable in `functions/src/basic-polls/callables.js` to compute eligible scheduler voters (`participantIds` + linked questing group members), detect missing voters (no submitted vote), and emit `BASIC_POLL_REQUIRED_CHANGED` to missing recipients.
  - Wired scheduler edit flow in `web/src/features/scheduler/CreateSchedulerPage.jsx` to invoke required-change notification via `notifyEmbeddedBasicPollRequiredChanged`.
  - Added `notifyEmbeddedBasicPollRequiredChanged` helper in `web/src/lib/data/basicPolls.js`.
  - Expanded callable test coverage in `functions/src/basic-polls/callables.test.js` for unauthenticated + invalid-argument error paths in addition to missing-voter recipient assertions.
- 2026-02-11: Test results for `P2 7.3` validation:
  - `npm --prefix functions run test -- src/basic-polls/callables.test.js` (pass, `12 passed`, exit code `0`).

- 2026-02-11: Completed `basic-poll` task `P2 8.1` (Dashboard "Polls to vote on"):
  - Added web data helpers in `web/src/lib/data/basicPolls.js`:
    - `fetchOpenGroupPollsWithoutVote(groupIds, userId)`
    - `fetchRequiredEmbeddedPollsWithoutVote(schedulerIds, userId)`
  - Added dashboard section in `web/src/features/dashboard/DashboardPage.jsx` that appears only when unvoted polls exist and shows per-poll title, context (`in [Group]` / `in [Scheduler]`), vote-type badge, required badge, deadline countdown, and "Vote" link.
  - Added dashboard tests in `web/src/features/dashboard/DashboardPage.test.jsx` for rendering/link navigation and empty-state suppression.
  - Added unit coverage in `web/src/lib/data/basicPolls.test.js` for both new unvoted-poll query helpers.
- 2026-02-11: Test results for `P2 8.1` validation:
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/dashboard/DashboardPage.test.jsx` (pass, `26 passed`, exit code `0`).

- 2026-02-11: Added `docs/v2-functions-migration-plan.md` with a codebase-specific Cloud Functions migration analysis and phased v1->v2 plan that accounts for active `basic-poll` execution state (`docs/basic-poll.md`, `docs/basic-poll-tasks.md`, `docs/fixtures/basic-polls-irv-fixtures.json`, `docs/plan-execution/basic-poll-task-list.md`, `docs/task-list.md`).
- 2026-02-11: Validation for v2 migration plan doc task:
  - Documentation-only change; no runtime code paths modified.
  - Tests not run (not applicable for this docs-only update).

- 2026-02-11: Completed `basic-poll` task `P2 6.4` by adding basic poll notification preferences across server and settings UI:
  - Added `BASIC_POLL_*` preference support in `functions/src/notifications/preferences.js` (email-eligible + simple-default sets).
  - Added preference coverage in `functions/src/notifications/preferences.test.js`.
  - Extended web notification event constants in `web/src/lib/data/notifications.js`.
  - Added a new "Basic polls" advanced notification group in `web/src/features/settings/SettingsPage.jsx` with per-event controls (`muted` / `inApp` / `inApp+Email`).
  - Extended settings tests in `web/src/features/settings/SettingsPage.test.jsx` for basic poll preference rendering.
- 2026-02-11: Test results for `P2 6.4` validation:
  - `npm --prefix functions run test -- src/legacy.callables.test.js src/notifications/preferences.test.js src/notifications/auto-clear.test.js src/notifications/router.test.js src/notifications/constants.test.js src/notifications/templates.test.js src/notifications/emit.test.js src/notifications/write-event.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js` (pass, `95 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/settings/SettingsPage.test.jsx src/features/settings/components/GroupCard.test.jsx src/lib/data/basicPolls.test.js src/features/basic-polls/GroupPollPage.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx` (pass, `44 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).

- 2026-02-11: Completed `basic-poll` task `P1 7.2` by extending `deleteUserAccount` cleanup for basic poll votes in `functions/src/legacy.js`:
  - Added explicit basic poll vote pruning across `questingGroups/{groupId}/basicPolls/*/votes/{uid}` and scheduler embedded basic poll vote paths for schedulers the user created or participated in.
  - Kept collection-group vote cleanup as a broad fallback and added explicit path-based cleanup before scheduler deletion/removal passes.
  - Reused scheduler snapshots to avoid redundant participant/creator scheduler queries.
- 2026-02-11: Added/updated `P1 7.2` callable tests in `functions/src/legacy.callables.test.js`:
  - Verified explicit basic poll vote deletion occurs during account deletion.
  - Added coverage for explicit basic poll cleanup behavior even when collection-group vote queries are empty.
- 2026-02-11: Test results for `P1 7.2` validation:
  - `npm --prefix functions run test -- src/legacy.callables.test.js src/notifications/auto-clear.test.js src/notifications/router.test.js src/notifications/constants.test.js src/notifications/templates.test.js src/notifications/emit.test.js src/notifications/write-event.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js` (pass, `89 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/basic-polls/GroupPollPage.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx` (pass, `41 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).

- 2026-02-11: Completed `basic-poll` task `P1 7.1` by extending `functions/src/legacy.js` `removeGroupMemberFromPolls` to prune basic poll votes for removed members:
  - Group-linked basic polls: removes member votes under `questingGroups/{groupId}/basicPolls/*/votes/{uid}` (with email-query fallback), gated to `OPEN` polls.
  - Scheduler-embedded basic polls: removes member votes under `schedulers/{schedulerId}/basicPolls/*/votes/{uid}` (with email-query fallback) when parent scheduler status is `OPEN`.
  - Added returned counters (`embeddedBasicPollsPruned`, `groupBasicPollsPruned`) for visibility in callable results.
- 2026-02-11: Added callable coverage in `functions/src/legacy.callables.test.js` for `removeGroupMemberFromPolls` to verify scheduler/group basic poll vote pruning and open-only behavior, and updated mocks to support group basic poll subcollection traversal.
- 2026-02-11: Test results for `P1 7.1` validation:
  - `npm --prefix functions run test -- src/legacy.callables.test.js src/notifications/auto-clear.test.js src/notifications/router.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js` (pass, `58 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/basic-polls/GroupPollPage.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx` (pass, `41 passed`, exit code `0`).

- 2026-02-11: Completed `basic-poll` task `P1 6.3` by extending `functions/src/notifications/auto-clear.js` with basic poll auto-clear rules:
  - `BASIC_POLL_FINALIZED` clears reminder/reopened/reset notifications for the same basic poll.
  - `BASIC_POLL_REOPENED` clears finalized notifications.
  - `BASIC_POLL_RESET` clears reminder + missing-required notices.
  - `BASIC_POLL_VOTE_SUBMITTED` clears the actorâ€™s own basic poll reminder.
  - `BASIC_POLL_REQUIRED_CHANGED` conditionally clears missing-required notices only when the payload marks the poll optional.
  - `BASIC_POLL_REMOVED` clears related missing-required notices.
- 2026-02-11: Added `P1 6.3` coverage in `functions/src/notifications/auto-clear.test.js` for each new basic poll auto-clear scenario, including the requiredâ†’optional conditional behavior.
- 2026-02-11: Test results for `P1 6.3` validation:
  - `npm --prefix functions run test -- src/notifications/auto-clear.test.js src/notifications/router.test.js src/notifications/constants.test.js src/notifications/templates.test.js src/notifications/emit.test.js src/notifications/write-event.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js` (pass, `65 passed`, exit code `0`).

- 2026-02-11: Completed `basic-poll` task `P1 6.1` by registering all `BASIC_POLL_*` notification events in `functions/src/notifications/constants.js`, adding shared basic poll template helpers (`functions/src/notifications/templates/basic-polls-shared.js`), adding in-app + email templates for each basic poll event, and wiring all mappings in `functions/src/notifications/templates/index.js`.
- 2026-02-11: Completed `basic-poll` task `P1 6.2` by moving basic poll notification emission onto server-owned paths:
  - Added privileged basic poll callables in `functions/src/basic-polls/callables.js` for create/finalize/reopen/remove/reset with server-side auth checks and notification event writes.
  - Added vote/deadline notification triggers in `functions/src/triggers/basic-polls.js` for `BASIC_POLL_VOTE_SUBMITTED` and `BASIC_POLL_DEADLINE_CHANGED`.
  - Added shared event writer `functions/src/notifications/write-event.js` and reused it from `functions/src/notifications/emit.js`.
  - Exported new callables/triggers in `functions/src/index.js`.
  - Updated web flows to use server paths for user actions (`createBasicPoll`, `createEmbeddedBasicPoll`, `deleteEmbeddedBasicPoll`, unsafe `resetBasicPollVotes`) with local fallback retained for cleanup/integration flows.
- 2026-02-11: Test results for `P1 6.1` + `P1 6.2`:
  - `npm --prefix functions run test -- src/notifications/constants.test.js src/notifications/templates.test.js src/notifications/emit.test.js src/notifications/write-event.test.js src/basic-polls/callables.test.js src/triggers/basic-polls.test.js` (pass, `41 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/basic-polls/GroupPollPage.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx` (pass, `41 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).

- 2026-02-11: Improved local plan-run output UX in `scripts/codex/run-local-plan.sh` by making terminal output human-readable by default, and adding `--verbose` to keep raw JSON event streaming; added renderer `scripts/codex/render-codex-events.js` while preserving raw logs in `events.jsonl`.
- 2026-02-11: Validation for local plan-run output update: `bash -n scripts/codex/run-local-plan.sh` (pass), `node --check scripts/codex/render-codex-events.js` (pass), `scripts/codex/run-local-plan.sh --prompt-file .codex/prompts/basic-poll-execute.md --dry-run` (pass), `scripts/codex/run-local-plan.sh --prompt-file .codex/prompts/basic-poll-execute.md --verbose --dry-run` (pass), formatter smoke test via `cat <<'EOF' | node scripts/codex/render-codex-events.js ... EOF` (pass), end-to-end smoke tests with temporary stub `codex` for default and `--verbose` modes (pass).
- 2026-02-11: Archived previous task list to `docs/task-list-archive-basic-poll-2026-02-11.md` and reset `docs/task-list.md` for basic-poll plan setup.
- 2026-02-11: Ensured `docs/external-feedback/` exists and verified consult scripts for Claude and Gemini are present/executable.
- 2026-02-11: Added a generic local Codex long-run setup: `scripts/codex/archive-task-list.sh`, `scripts/codex/bootstrap-plan-execution.sh`, `scripts/codex/init-plan-run.sh`, `scripts/codex/run-local-plan.sh`, plus the new skill `.codex/skills/execute-local-plan/SKILL.md`.
- 2026-02-11: Bootstrapped basic-poll execution artifacts: `docs/plan-execution/basic-poll-task-list.md` and `.codex/prompts/basic-poll-execute.md`.
- 2026-02-11: Validated Codex setup scripts. Commands: `bash -n scripts/codex/archive-task-list.sh scripts/codex/bootstrap-plan-execution.sh scripts/codex/init-plan-run.sh scripts/codex/init-basic-poll-run.sh scripts/codex/run-local-plan.sh` (pass), `scripts/codex/run-local-plan.sh --prompt-file .codex/prompts/basic-poll-execute.md --dry-run` (pass), `scripts/codex/bootstrap-plan-execution.sh --plan-id sample --plan-doc docs/basic-poll.md --tasks-doc docs/basic-poll-tasks.md --output docs/plan-execution/sample-task-list.md --force` (pass; temporary file removed).
- 2026-02-11: Re-validated script portability with absolute paths. Commands: `scripts/codex/run-local-plan.sh --prompt-file $(pwd)/.codex/prompts/basic-poll-execute.md --output-dir $(pwd)/.codex/runs --dry-run` (pass), `scripts/codex/init-plan-run.sh --plan-id basic-poll-temp --plan-doc $(pwd)/docs/basic-poll.md --tasks-doc $(pwd)/docs/basic-poll-tasks.md --execution-task-list $(pwd)/docs/plan-execution/basic-poll-temp-task-list.md --prompt-file $(pwd)/.codex/prompts/basic-poll-temp-execute.md --force` (pass; temporary files removed).
- 2026-02-11: Archived legacy skills to `.codex/skills-archive/2026-02-11/`: `execute-plan-unified-notification-overhaul`, `test-plan-runner`, `ts-migration-chunk`; updated `AGENTS.md` to remove active references to archived skills. Tests not run (docs/file-move only).
- 2026-02-11: Matched local plan runner defaults to `codex-yolo` by adding `-c model_reasoning_effort="high"` to `scripts/codex/run-local-plan.sh` (override: `--reasoning-effort`, disable: `--reasoning-effort off`). Validation: `bash -n scripts/codex/run-local-plan.sh` (pass), `scripts/codex/run-local-plan.sh --prompt-file .codex/prompts/basic-poll-execute.md --dry-run` (pass; command includes high reasoning), `scripts/codex/run-local-plan.sh --prompt-file .codex/prompts/basic-poll-execute.md --reasoning-effort off --dry-run` (pass).
- 2026-02-11: Hardened local run success detection so `scripts/codex/run-local-plan.sh` now fails if `final-message.md` is missing (common with early Ctrl+C), avoiding false-success output. Validation: `bash -n scripts/codex/run-local-plan.sh` (pass), `scripts/codex/run-local-plan.sh --prompt-file .codex/prompts/basic-poll-execute.md --dry-run` (pass).
- 2026-02-11: Completed `basic-poll` task `P1 1.1` (group-linked basic poll Firestore rules + acceptance tests). Updated `firestore.rules` with `questingGroups/{groupId}/basicPolls/{pollId}` and `.../votes/{userId}` permissions, and expanded `web/src/__tests__/rules/rules.test.js` to cover member read, manager create/edit/finalize/reopen, non-member denial, own-vote-only writes, and vote blocking after finalization/deadline.
- 2026-02-11: Test results for `P1 1.1`:
  - `npm --prefix web run test:rules` â†’ tests passed (`18 passed`) but command exited non-zero due Firebase CLI update-check config permission issue.
  - `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:rules` â†’ pass (`18 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 1.2` (scheduler-embedded basic poll Firestore rules + acceptance tests). Added `schedulers/{schedulerId}/basicPolls/{pollId}` and embedded vote rules in `firestore.rules`, and expanded `web/src/__tests__/rules/rules.test.js` with creator CRUD checks, participant vote checks, non-participant denial, and closed/deadline write blocking.
- 2026-02-11: Test results for `P1 1.2`: `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:rules` â†’ pass (`21 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 1.3` by adding Firestore indexes for `basicPolls` (`status + createdAt`, `order`) and collection-group `votes` support in `firestore.indexes.json`.
- 2026-02-11: Test/validation results for `P1 1.3`: `node -e "const fs=require('fs'); JSON.parse(fs.readFileSync('firestore.indexes.json','utf8')); console.log('firestore.indexes.json parse: ok');"` (pass), `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:rules` (pass, `21 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 2.1` by adding `web/src/lib/data/basicPolls.js` (group-linked poll CRUD + finalize/reopen + batched vote cleanup delete + subscriptions), plus `web/src/lib/data/basicPolls.test.js` and `web/src/__tests__/integration/basic-polls.integration.test.js`.
- 2026-02-11: During `P1 2.1` integration validation, fixed two rule null-safety issues in `firestore.rules`: `isGroupInvitee` now guards missing `pendingInvites`, and basic poll writable checks now guard missing `deadlineAt`.
- 2026-02-11: Test results for `P1 2.1`: `npm --prefix web run test -- src/lib/data/basicPolls.test.js` (pass, `8 passed`), `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:rules` (pass, `21 passed`), `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config npm --prefix web run test:integration` (failed before tests due extension emulator API permissions), `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config firebase emulators:exec --project studio-473406021-87ead --only auth,firestore "cd web && npx vitest run --config vitest.integration.config.js src/__tests__/integration/basic-polls.integration.test.js"` (pass, `2 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 2.2` by extending `web/src/lib/data/basicPolls.js` with cross-parent vote helpers (`submitBasicPollVote`, `deleteBasicPollVote`, `subscribeToBasicPollVotes`, `subscribeToMyBasicPollVote`) for both `group` and `scheduler` paths.
- 2026-02-11: Added `P1 2.2` tests in `web/src/lib/data/basicPolls.test.js` (unit) and expanded `web/src/__tests__/integration/basic-polls.integration.test.js` (emulator integration) to cover vote create/update/delete + subscriptions.
- 2026-02-11: Test results for `P1 2.2`: `npm --prefix web run test -- src/lib/data/basicPolls.test.js` (pass, `12 passed`), `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config firebase emulators:exec --project studio-473406021-87ead --only auth,firestore "cd web && npx vitest run --config vitest.integration.config.js src/__tests__/integration/basic-polls.integration.test.js"` (pass, `4 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 2.3` by adding scheduler-embedded basic poll data helpers in `web/src/lib/data/basicPolls.js`: `createEmbeddedBasicPoll`, `updateEmbeddedBasicPoll`, `deleteEmbeddedBasicPoll`, `reorderEmbeddedBasicPolls`, and `subscribeToEmbeddedBasicPolls`.
- 2026-02-11: Added `P1 2.3` tests in `web/src/lib/data/basicPolls.test.js` and `web/src/__tests__/integration/basic-polls.integration.test.js` for embedded CRUD/reorder/delete cleanup + subscription behavior.
- 2026-02-11: Test results for `P1 2.3`: `npm --prefix web run test -- src/lib/data/basicPolls.test.js` (pass, `17 passed`), `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config firebase emulators:exec --project studio-473406021-87ead --only auth,firestore "cd web && npx vitest run --config vitest.integration.config.js src/__tests__/integration/basic-polls.integration.test.js"` (pass, `5 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 2.4` by extending deletion cleanup flows:
  - `web/src/lib/data/pollInvites.js`: `removeParticipantFromPoll` now removes scheduler embedded basic poll votes for resolved participant UID.
  - `web/src/lib/data/questingGroups.js`: `deleteQuestingGroup` now deletes `questingGroups/{groupId}/basicPolls/*` and vote subdocs before deleting the group doc.
  - `web/src/lib/data/schedulers.js`: added `deleteSchedulerWithRelatedData` to delete scheduler slots, scheduler votes, embedded basic polls, and embedded poll votes before scheduler deletion.
  - `web/src/features/scheduler/SchedulerPage.jsx`: delete flow now uses `deleteSchedulerWithRelatedData`.
- 2026-02-11: Updated integration harness for reliable `P1 2.4` validation:
  - `web/src/__tests__/integration/basic-polls.integration.test.js`: post-delete existence checks now read under `withSecurityRulesDisabled` for deleted parent resources.
  - `web/vitest.integration.config.js`: set `fileParallelism: false` so integration files run serially with shared emulator/auth state.
- 2026-02-11: Test results for `P1 2.4`:
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/lib/data/pollInvites.test.js src/lib/data/questingGroups.test.js` (pass, `41 passed`, exit code `0`).
  - `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config firebase emulators:exec --project studio-473406021-87ead --only auth,firestore "cd web && npx vitest run --config vitest.integration.config.js src/__tests__/integration/poll-invites.integration.test.js src/__tests__/integration/basic-polls.integration.test.js"` (pass, `9 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.1` by adding standalone group poll routing and shell:
  - New `web/src/features/basic-polls/GroupPollPage.jsx` with group-member gating and poll loading through `subscribeToBasicPoll(groupId, pollId)`.
  - Added explicit loading/error/not-found/access-denied states for the group poll route.
  - Wired `/groups/:groupId/polls/:pollId` in `web/src/App.jsx` and included this path in post-login redirect handling.
- 2026-02-11: Added `P1 3.1` component tests in `web/src/features/basic-polls/GroupPollPage.test.jsx` for shell rendering (member) and access denied (non-member).
- 2026-02-11: Test results for `P1 3.1`: `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx` (pass, `2 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.2` by implementing GroupPollPage multiple-choice voting:
  - Added single/multi-select option UI, `maxSelections` handling, submit/clear actions, and write-in Other support with validation.
  - Added live results bars sorted by vote count, empty state ("No votes yet"), and expandable voter breakdown with avatar chips.
  - Added read-only behavior when poll status is not writable or deadline has passed.
- 2026-02-11: Expanded `P1 3.2` component coverage in `web/src/features/basic-polls/GroupPollPage.test.jsx` for cast/change/clear flows and live result updates.
- 2026-02-11: Test results for `P1 3.2`: `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx` (pass, `5 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.3` by adding ranked-choice voting on `GroupPollPage`:
  - Implemented drag-to-rank with `@dnd-kit` and mobile arrow fallback controls.
  - Added partial ranking support with ranked + unranked sections.
  - Added submit/clear ranking actions and live first-choice results view for open polls.
- 2026-02-11: Installed ranked voting drag dependencies in `web`: `@dnd-kit/core`, `@dnd-kit/sortable`, `@dnd-kit/utilities`.
- 2026-02-11: Expanded `P1 3.3` tests in `web/src/features/basic-polls/GroupPollPage.test.jsx` for ranked submit, arrow reorder behavior, drag-handle presence, and live first-choice counts.
- 2026-02-11: Test results for `P1 3.3`: `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx` (pass, `7 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.4` by refining multiple-choice results in `GroupPollPage`:
  - Added winner highlighting (badge + accent), tie-safe winner display, and finalized read-only behavior.
  - Updated multi-select result labels to `X of N voters` with percentages.
  - Grouped write-ins case-insensitively by trimmed text for result bars.
- 2026-02-11: Expanded `P1 3.4` tests in `web/src/features/basic-polls/GroupPollPage.test.jsx` for write-in grouping, winner highlighting, and finalized poll read-only results.
- 2026-02-11: Test results for `P1 3.4`: `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx` (pass, `9 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.5` by adding finalized ranked-choice results:
  - Added IRV utility `web/src/lib/basic-polls/irv.js` and connected it to ranked poll results when voting is closed.
  - Implemented static round-by-round result summary with exhausted ballot counts and tie messaging for creators.
  - Kept open ranked polls on live first-choice tallies.
- 2026-02-11: Added tests for `P1 3.5` in `web/src/lib/basic-polls/irv.test.js` and expanded `web/src/features/basic-polls/GroupPollPage.test.jsx`.
- 2026-02-11: Test results for `P1 3.5`: `npm --prefix web run test -- src/lib/basic-polls/irv.test.js src/features/basic-polls/GroupPollPage.test.jsx` (pass, `13 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.6` by validating manager edit mode acceptance for `GroupPollPage` and tightening test coverage:
  - Updated unsafe-edit vote-type test selector to target the edit form combobox reliably.
  - Added coverage confirming non-manager group members cannot access edit mode controls.
- 2026-02-11: Test results for `P1 3.6`: `npm --prefix web run test -- src/features/basic-polls/GroupPollPage.test.jsx src/lib/data/basicPolls.test.js src/lib/basic-polls/irv.test.js` (pass, `36 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.7` by adding a Polls section to the questing group card:
  - `web/src/features/settings/components/GroupCard.jsx` now shows open polls with `X/Y voted` progress, vote-type badges, deadlines, and links to `/groups/:groupId/polls/:pollId`.
  - Added a recent finalized poll list (last five) and manager-only "Create poll" entry-point modal shell.
- 2026-02-11: Added/updated `P1 3.7` tests in `web/src/features/settings/components/GroupCard.test.jsx` for poll section rendering, link paths, and create-poll modal opening.
- 2026-02-11: Test results for `P1 3.7`: `npm --prefix web run test -- src/features/settings/components/GroupCard.test.jsx` (pass, `4 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 3.8` by implementing the standalone group poll creation modal and wiring it into group cards:
  - Added `web/src/features/basic-polls/components/CreateGroupPollModal.jsx` with required title, markdown description write/preview, vote type/settings controls, options editor (add/remove/reorder), option note markdown modal, optional deadline, and save via `createBasicPoll`.
  - Updated `web/src/features/settings/components/GroupCard.jsx` to use this modal for manager "Create poll" actions.
  - Expanded tests so creation from the modal is validated and newly-created polls appear in the group card list.
- 2026-02-11: Test results for `P1 3.8`:
  - `npm --prefix web run test -- src/features/settings/components/GroupCard.test.jsx` (pass, `5 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/settings/components/GroupCard.test.jsx src/features/basic-polls/GroupPollPage.test.jsx src/lib/data/basicPolls.test.js src/lib/basic-polls/irv.test.js` (pass, `41 passed`, exit code `0`).
- 2026-02-11: Completed `basic-poll` task `P1 4.1` by adding embedded poll management in scheduler edit mode:
  - `web/src/features/scheduler/CreateSchedulerPage.jsx` now includes an "Embedded polls" section with add/edit/remove actions, required/optional and vote-type badges, `X/Y voted` status, and drag-to-reorder with persisted `order`.
  - Added `web/src/features/scheduler/components/EmbeddedPollEditorModal.jsx` for embedded poll create/edit flow (markdown description + option notes, vote settings, required toggle, optional deadline, option list management).
  - Added deletion confirmation and integrated embedded poll CRUD data-layer helpers.
- 2026-02-11: Added `P1 4.1` tests in `web/src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx` for create payload and edit-state initialization.
- 2026-02-11: Test results for `P1 4.1`:
  - `npm --prefix web run test -- src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx` (pass, `7 passed`, exit code `0`).
  - `npm --prefix web run test -- src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx src/features/basic-polls/GroupPollPage.test.jsx src/lib/data/basicPolls.test.js src/lib/basic-polls/irv.test.js` (pass, `43 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).
- 2026-02-11: Completed `basic-poll` task `P1 4.2` by adding embedded poll voting to the scheduler page:
  - `web/src/features/scheduler/SchedulerPage.jsx` now subscribes to embedded polls + votes and renders stacked poll cards with inline voting controls.
  - Added per-card multiple-choice and ranked-choice vote submission/clearing, required-poll pending badges, `X/Y voted` status, and progress tracking (`completed/total`).
  - Embedded voting actions are gated by scheduler writability (`OPEN` + participant) and show per-poll errors when invalid.
- 2026-02-11: Test results for `P1 4.2`:
  - `npm --prefix web run test -- src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx src/features/basic-polls/GroupPollPage.test.jsx src/lib/data/basicPolls.test.js src/lib/basic-polls/irv.test.js` (pass, `43 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).
- 2026-02-11: Completed `basic-poll` task `P1 4.4` by aligning embedded poll status with parent scheduler state:
  - `web/src/features/scheduler/SchedulerPage.jsx` now renders embedded poll cards as read-only summaries when the scheduler is not writable (`FINALIZED`/`CANCELLED`), while keeping vote controls active only when scheduler status is `OPEN` and the user is vote-eligible.
  - Embedded poll status remains parent-derived (no independent embedded status field management in docs/writes).
  - Firestore parent-status write enforcement from `P1 1.2` continues to backstop UI gating.
- 2026-02-11: Test results for `P1 4.4`:
  - `npm --prefix web run test -- src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx src/features/basic-polls/GroupPollPage.test.jsx src/lib/data/basicPolls.test.js src/lib/basic-polls/irv.test.js` (pass, `43 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).
- 2026-02-11: Completed `basic-poll` task `P1 5.1` by implementing and validating IRV parity across web/functions:
  - Replaced `web/src/lib/basic-polls/irv.js` with enhanced IRV tie-handling (backward tie-break + safe batch elimination) and exhausted ballot accounting.
  - Added `functions/src/basic-polls/irv.js` so server-side and web-side use equivalent IRV behavior.
  - Added shared fixture contracts in `docs/fixtures/basic-polls-irv-fixtures.json` and wired both web/functions IRV tests to the same fixtures.
  - Added explicit parity assertions in `web/src/lib/basic-polls/irv.test.js` against the functions implementation.
- 2026-02-11: Test results for `P1 5.1`:
  - `npm --prefix web run test -- src/lib/basic-polls/irv.test.js` (pass, `14 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/basic-polls/irv.test.js` (pass, `7 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/basic-polls/irv.test.js src/features/basic-polls/GroupPollPage.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx src/lib/data/basicPolls.test.js` (pass, `53 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).
- 2026-02-11: Completed `basic-poll` task `P1 5.2` by introducing a dedicated multiple-choice tally utility:
  - Added `web/src/lib/basic-polls/multiple-choice.js` to compute per-option tallies, percentages, sorting, and write-in grouping.
  - Rewired `web/src/features/basic-polls/GroupPollPage.jsx` to consume this utility for multiple-choice results.
  - Added focused utility tests in `web/src/lib/basic-polls/multiple-choice.test.js`.
- 2026-02-11: Test results for `P1 5.2`:
  - `npm --prefix web run test -- src/lib/basic-polls/multiple-choice.test.js src/lib/basic-polls/irv.test.js src/features/basic-polls/GroupPollPage.test.jsx` (pass, `30 passed`, exit code `0`).
  - `npm --prefix web run test -- src/lib/basic-polls/multiple-choice.test.js src/lib/basic-polls/irv.test.js src/features/basic-polls/GroupPollPage.test.jsx src/features/scheduler/components/EmbeddedPollEditorModal.test.jsx src/features/settings/components/GroupCard.test.jsx src/lib/data/basicPolls.test.js` (pass, `57 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/basic-polls/irv.test.js` (pass, `7 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).
- 2026-02-11: Completed `basic-poll` task `P1 5.3` (Finalized result snapshots):
  - `web/src/lib/data/basicPolls.js`: `finalizeBasicPoll(...)` now computes immutable `finalResults` snapshots from current vote docs (multiple-choice and ranked-choice) and writes `status`, `finalizedAt`, `finalResults`, and `updatedAt` together.
  - `functions/src/legacy.js`: `googleCalendarFinalizePoll` now computes and stores `finalResults` snapshots for each embedded basic poll before finalizing the parent scheduler.
  - `web/src/features/basic-polls/GroupPollPage.jsx`: finalized polls now read `poll.finalResults` as the canonical source for closed results (fallbacks preserved for non-snapshot legacy docs).
  - `web/src/features/scheduler/SchedulerPage.jsx`: embedded poll cards now render closed-state final results from each pollâ€™s `finalResults` snapshot and use snapshot `voterCount` when available.
  - Added functions multiple-choice utility for server snapshots at `functions/src/basic-polls/multiple-choice.js`.
- 2026-02-11: Test results for `P1 5.3`:
  - `npm --prefix web run test -- src/lib/data/basicPolls.test.js src/features/basic-polls/GroupPollPage.test.jsx` (pass, `34 passed`, exit code `0`).
  - `mkdir -p /tmp/firebase-config && XDG_CONFIG_HOME=/tmp/firebase-config firebase emulators:exec --project studio-473406021-87ead --only auth,firestore "cd web && npx vitest run --config vitest.integration.config.js src/__tests__/integration/basic-polls.integration.test.js"` (pass, `8 passed`, exit code `0`).
  - `npm --prefix functions run test -- src/basic-polls/irv.test.js src/basic-polls/multiple-choice.test.js src/legacy.calendar.test.js` (pass, `16 passed`, exit code `0`).
  - `npm --prefix web run build` (pass; Vite build completed with existing non-blocking chunk-size warnings).
